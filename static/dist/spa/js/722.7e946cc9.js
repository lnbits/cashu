(globalThis["webpackChunkcashu"]=globalThis["webpackChunkcashu"]||[]).push([[722],{1735:function(t,e,n){n(9665),n(5231),n(3075),n(548),n(2079),n(8218),n(6046),function(t,n){n(e)}(0,(function(t){"use strict";const e={},n=Object.freeze({__proto__:null,default:e}),o=BigInt(0),i=BigInt(1),a=BigInt(2),s=BigInt(3),r=BigInt(8),l=a**BigInt(256),c={a:o,b:BigInt(7),P:l-a**BigInt(32)-BigInt(977),n:l-BigInt("432420386565659656852420866394968145599"),h:i,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")};function u(t){const{a:e,b:n}=c,o=M(t*t),i=M(o*t);return M(i+e*t+n)}const h=c.a===o;class d{constructor(t,e,n){this.x=t,this.y=e,this.z=n}static fromAffine(t){if(!(t instanceof p))throw new TypeError("JacobianPoint#fromAffine: expected Point");return new d(t.x,t.y,i)}static toAffineBatch(t){const e=E(t.map((t=>t.z)));return t.map(((t,n)=>t.toAffine(e[n])))}static normalizeZ(t){return d.toAffineBatch(t).map(d.fromAffine)}equals(t){if(!(t instanceof d))throw new TypeError("JacobianPoint expected");const{x:e,y:n,z:o}=this,{x:i,y:s,z:r}=t,l=M(o**a),c=M(r**a),u=M(e*c),h=M(i*l),m=M(M(n*r)*c),p=M(M(s*o)*l);return u===h&&m===p}negate(){return new d(this.x,M(-this.y),this.z)}double(){const{x:t,y:e,z:n}=this,o=M(t**a),i=M(e**a),l=M(i**a),c=M(a*(M((t+i)**a)-o-l)),u=M(s*o),h=M(u**a),m=M(h-a*c),p=M(u*(c-m)-r*l),f=M(a*e*n);return new d(m,p,f)}add(t){if(!(t instanceof d))throw new TypeError("JacobianPoint expected");const{x:e,y:n,z:i}=this,{x:s,y:r,z:l}=t;if(s===o||r===o)return this;if(e===o||n===o)return t;const c=M(i**a),u=M(l**a),h=M(e*u),m=M(s*c),p=M(M(n*l)*u),f=M(M(r*i)*c),w=M(m-h),y=M(f-p);if(w===o)return y===o?this.double():d.ZERO;const g=M(w**a),v=M(w*g),k=M(h*g),b=M(y**a-v-a*k),D=M(y*(k-b)-p*v),S=M(i*l*w);return new d(b,D,S)}subtract(t){return this.add(t.negate())}multiplyUnsafe(t){const e=d.ZERO;if("bigint"===typeof t&&t===o)return e;let n=W(t);if(n===i)return this;if(!h){let t=e,a=this;while(n>o)n&i&&(t=t.add(a)),a=a.double(),n>>=i;return t}let{k1neg:a,k1:s,k2neg:r,k2:l}=R(n),u=e,m=e,p=this;while(s>o||l>o)s&i&&(u=u.add(p)),l&i&&(m=m.add(p)),p=p.double(),s>>=i,l>>=i;return a&&(u=u.negate()),r&&(m=m.negate()),m=new d(M(m.x*c.beta),m.y,m.z),u.add(m)}precomputeWindow(t){const e=h?128/t+1:256/t+1,n=[];let o=this,i=o;for(let a=0;a<e;a++){i=o,n.push(i);for(let e=1;e<2**(t-1);e++)i=i.add(o),n.push(i);o=i.double()}return n}wNAF(t,e){!e&&this.equals(d.BASE)&&(e=p.BASE);const n=e&&e._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let o=e&&m.get(e);o||(o=this.precomputeWindow(n),e&&1!==n&&(o=d.normalizeZ(o),m.set(e,o)));let a=d.ZERO,s=d.ZERO;const r=1+(h?128/n:256/n),l=2**(n-1),c=BigInt(2**n-1),u=2**n,f=BigInt(n);for(let h=0;h<r;h++){const e=h*l;let n=Number(t&c);if(t>>=f,n>l&&(n-=u,t+=i),0===n){let t=o[e];h%2&&(t=t.negate()),s=s.add(t)}else{let t=o[e+Math.abs(n)-1];n<0&&(t=t.negate()),a=a.add(t)}}return{p:a,f:s}}multiply(t,e){let n,o,i=W(t);if(h){const{k1neg:t,k1:a,k2neg:s,k2:r}=R(i);let{p:l,f:u}=this.wNAF(a,e),{p:h,f:m}=this.wNAF(r,e);t&&(l=l.negate()),s&&(h=h.negate()),h=new d(M(h.x*c.beta),h.y,h.z),n=l.add(h),o=u.add(m)}else{const{p:t,f:a}=this.wNAF(i,e);n=t,o=a}return d.normalizeZ([n,o])[0]}toAffine(t=C(this.z)){const{x:e,y:n,z:o}=this,a=t,s=M(a*a),r=M(s*a),l=M(e*s),c=M(n*r),u=M(o*a);if(u!==i)throw new Error("invZ was invalid");return new p(l,c)}}d.BASE=new d(c.Gx,c.Gy,i),d.ZERO=new d(o,i,o);const m=new WeakMap;class p{constructor(t,e){this.x=t,this.y=e}_setWindowSize(t){this._WINDOW_SIZE=t,m.delete(this)}static fromCompressedHex(t){const e=32===t.length,n=T(e?t:t.subarray(1));if(!O(n))throw new Error("Point is not on curve");const o=u(n);let a=A(o);const s=(a&i)===i;if(e)s&&(a=M(-a));else{const e=1===(1&t[0]);e!==s&&(a=M(-a))}const r=new p(n,a);return r.assertValidity(),r}static fromUncompressedHex(t){const e=T(t.subarray(1,33)),n=T(t.subarray(33,65)),o=new p(e,n);return o.assertValidity(),o}static fromHex(t){const e=U(t),n=e.length,o=e[0];if(32===n||33===n&&(2===o||3===o))return this.fromCompressedHex(e);if(65===n&&4===o)return this.fromUncompressedHex(e);throw new Error(`Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not ${n}`)}static fromPrivateKey(t){return p.BASE.multiply(Q(t))}static fromSignature(t,e,n){t=U(t);const o=Z(t),{r:i,s:a}=N(e);if(0!==n&&1!==n)throw new Error("Cannot recover signature: invalid recovery bit");const s=1&n?"03":"02",r=p.fromHex(s+S(i)),{n:l}=c,u=C(i,l),h=M(-o*u,l),d=M(a*u,l),m=p.BASE.multiplyAndAddUnsafe(r,h,d);if(!m)throw new Error("Cannot recover signature: point at infinify");return m.assertValidity(),m}toRawBytes(t=!1){return I(this.toHex(t))}toHex(t=!1){const e=S(this.x);if(t){const t=this.y&i?"03":"02";return`${t}${e}`}return`04${e}${S(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const t="Point is not on elliptic curve",{x:e,y:n}=this;if(!O(e)||!O(n))throw new Error(t);const i=M(n*n),a=u(e);if(M(i-a)!==o)throw new Error(t)}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new p(this.x,M(-this.y))}double(){return d.fromAffine(this).double().toAffine()}add(t){return d.fromAffine(this).add(d.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return d.fromAffine(this).multiply(t,this).toAffine()}multiplyAndAddUnsafe(t,e,n){const a=d.fromAffine(this),s=e===o||e===i||this!==p.BASE?a.multiplyUnsafe(e):a.multiply(e),r=d.fromAffine(t).multiplyUnsafe(n),l=s.add(r);return l.equals(d.ZERO)?void 0:l.toAffine()}}function f(t){return Number.parseInt(t[0],16)>=8?"00"+t:t}function w(t){if(t.length<2||2!==t[0])throw new Error(`Invalid signature integer tag: ${D(t)}`);const e=t[1],n=t.subarray(2,e+2);if(!e||n.length!==e)throw new Error("Invalid signature integer: wrong length");if(0===n[0]&&n[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:T(n),left:t.subarray(e+2)}}function y(t){if(t.length<2||48!=t[0])throw new Error(`Invalid signature tag: ${D(t)}`);if(t[1]!==t.length-2)throw new Error("Invalid signature: incorrect length");const{data:e,left:n}=w(t.subarray(2)),{data:o,left:i}=w(n);if(i.length)throw new Error(`Invalid signature: left bytes after parsing: ${D(i)}`);return{r:e,s:o}}p.BASE=new p(c.Gx,c.Gy),p.ZERO=new p(o,o);class g{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromCompact(t){const e=k(t),n="Signature.fromCompact";if("string"!==typeof t&&!e)throw new TypeError(`${n}: Expected string or Uint8Array`);const o=e?D(t):t;if(128!==o.length)throw new Error(`${n}: Expected 64-byte hex`);return new g(x(o.slice(0,64)),x(o.slice(64,128)))}static fromDER(t){const e=k(t);if("string"!==typeof t&&!e)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:n,s:o}=y(e?t:I(t));return new g(n,o)}static fromHex(t){return this.fromDER(t)}assertValidity(){const{r:t,s:e}=this;if(!z(t))throw new Error("Invalid Signature: r must be 0 < r < n");if(!z(e))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const t=c.n>>i;return this.s>t}normalizeS(){return this.hasHighS()?new g(this.r,c.n-this.s):this}toDERRawBytes(t=!1){return I(this.toDERHex(t))}toDERHex(t=!1){const e=f(q(this.s));if(t)return e;const n=f(q(this.r)),o=q(n.length/2),i=q(e.length/2),a=q(n.length/2+e.length/2+4);return`30${a}02${o}${n}02${i}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return I(this.toCompactHex())}toCompactHex(){return S(this.r)+S(this.s)}}function v(...t){if(!t.every(k))throw new Error("Uint8Array list expected");if(1===t.length)return t[0];const e=t.reduce(((t,e)=>t+e.length),0),n=new Uint8Array(e);for(let o=0,i=0;o<t.length;o++){const e=t[o];n.set(e,i),i+=e.length}return n}function k(t){return t instanceof Uint8Array}const b=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function D(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let n=0;n<t.length;n++)e+=b[t[n]];return e}function S(t){if(t>l)throw new Error("Expected number < 2^256");return t.toString(16).padStart(64,"0")}function _(t){return I(S(t))}function q(t){const e=t.toString(16);return 1&e.length?`0${e}`:e}function x(t){if("string"!==typeof t)throw new TypeError("hexToNumber: expected string, got "+typeof t);return BigInt(`0x${t}`)}function I(t){if("string"!==typeof t)throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+t.length);const e=new Uint8Array(t.length/2);for(let n=0;n<e.length;n++){const o=2*n,i=t.slice(o,o+2),a=Number.parseInt(i,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");e[n]=a}return e}function T(t){return x(D(t))}function U(t){return t instanceof Uint8Array?Uint8Array.from(t):I(t)}function W(t){if("number"===typeof t&&Number.isSafeInteger(t)&&t>0)return BigInt(t);if("bigint"===typeof t&&z(t))return t;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function M(t,e=c.P){const n=t%e;return n>=o?n:e+n}function P(t,e){const{P:n}=c;let i=t;while(e-- >o)i*=i,i%=n;return i}function A(t){const{P:e}=c,n=BigInt(6),o=BigInt(11),i=BigInt(22),r=BigInt(23),l=BigInt(44),u=BigInt(88),h=t*t*t%e,d=h*h*t%e,m=P(d,s)*d%e,p=P(m,s)*d%e,f=P(p,a)*h%e,w=P(f,o)*f%e,y=P(w,i)*w%e,g=P(y,l)*y%e,v=P(g,u)*g%e,k=P(v,l)*y%e,b=P(k,s)*d%e,D=P(b,r)*w%e,S=P(D,n)*h%e;return P(S,a)}function C(t,e=c.P){if(t===o||e<=o)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=M(t,e),a=e,s=o,r=i;while(n!==o){const t=a/n,e=a%n,o=s-r*t;a=n,n=e,s=r,r=o}const l=a;if(l!==i)throw new Error("invert: does not exist");return M(s,e)}function E(t,e=c.P){const n=new Array(t.length),a=t.reduce(((t,i,a)=>i===o?t:(n[a]=t,M(t*i,e))),i),s=C(a,e);return t.reduceRight(((t,i,a)=>i===o?t:(n[a]=M(t*n[a],e),M(t*i,e))),s),n}const B=(t,e)=>(t+e/a)/e,V=a**BigInt(128);function R(t){const{n:e}=c,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),o=-i*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),a=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,r=B(s*t,e),l=B(-o*t,e);let u=M(t-r*n-l*a,e),h=M(-r*o-l*s,e);const d=u>V,m=h>V;if(d&&(u=e-u),m&&(h=e-h),u>V||h>V)throw new Error("splitScalarEndo: Endomorphism failed, k="+t);return{k1neg:d,k1:u,k2neg:m,k2:h}}function Z(t){const{n:e}=c,n=t.length,o=8*n-256;let i=T(t);return o>0&&(i>>=BigInt(o)),i>=e&&(i-=e),i}class H{constructor(){this.v=new Uint8Array(32).fill(1),this.k=new Uint8Array(32).fill(0),this.counter=0}hmac(...t){return _t.hmacSha256(this.k,...t)}hmacSync(...t){if("function"!==typeof _t.hmacSha256Sync)throw new Error("utils.hmacSha256Sync is undefined, you need to set it");const e=_t.hmacSha256Sync(this.k,...t);if(e instanceof Promise)throw new Error("To use sync sign(), ensure utils.hmacSha256 is sync");return e}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(t=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),t),this.v=await this.hmac(this.v),0!==t.length&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),t),this.v=await this.hmac(this.v))}reseedSync(t=new Uint8Array){this.k=this.hmacSync(this.v,Uint8Array.from([0]),t),this.v=this.hmacSync(this.v),0!==t.length&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),t),this.v=this.hmacSync(this.v))}async generate(){return this.incr(),this.v=await this.hmac(this.v),this.v}generateSync(){return this.incr(),this.v=this.hmacSync(this.v),this.v}}function z(t){return o<t&&t<c.n}function O(t){return o<t&&t<c.P}function L(t,e,n){const a=T(t);if(!z(a))return;const{n:s}=c,r=p.BASE.multiply(a),l=M(r.x,s);if(l===o)return;const u=M(C(a,s)*M(e+n*l,s),s);if(u===o)return;const h=new g(l,u),d=(r.x===h.r?0:2)|Number(r.y&i);return{sig:h,recovery:d}}function Q(t){let e;if("bigint"===typeof t)e=t;else if("number"===typeof t&&Number.isSafeInteger(t)&&t>0)e=BigInt(t);else if("string"===typeof t){if(64!==t.length)throw new Error("Expected 32 bytes of private key");e=x(t)}else{if(!k(t))throw new TypeError("Expected valid private key");if(32!==t.length)throw new Error("Expected 32 bytes of private key");e=T(t)}if(!z(e))throw new Error("Expected private key: 0 < key < n");return e}function $(t){return t instanceof p?(t.assertValidity(),t):p.fromHex(t)}function N(t){if(t instanceof g)return t.assertValidity(),t;try{return g.fromDER(t)}catch(e){return g.fromCompact(t)}}function j(t,e=!1){return p.fromPrivateKey(t).toRawBytes(e)}function K(t,e,n,o=!1){return p.fromSignature(t,e,n).toRawBytes(o)}function F(t){const e=k(t),n="string"===typeof t,o=(e||n)&&t.length;return e?33===o||65===o:n?66===o||130===o:t instanceof p}function J(t,e,n=!1){if(F(t))throw new TypeError("getSharedSecret: first arg must be private key");if(!F(e))throw new TypeError("getSharedSecret: second arg must be public key");const o=$(e);return o.assertValidity(),o.multiply(Q(t)).toRawBytes(n)}function Y(t){const e=t.length>32?t.slice(0,32):t;return T(e)}function G(t){const e=Y(t),n=M(e,c.n);return X(n<o?e:n)}function X(t){if("bigint"!==typeof t)throw new Error("Expected bigint");const e=S(t);return I(e)}function tt(t,e,n){if(null==t)throw new Error(`sign: expected valid message hash, not "${t}"`);const o=U(t),i=Q(e),a=[X(i),G(o)];if(null!=n){!0===n&&(n=_t.randomBytes(32));const t=U(n);if(32!==t.length)throw new Error("sign: Expected 32 bytes of extra data");a.push(t)}const s=v(...a),r=Y(o);return{seed:s,m:r,d:i}}function et(t,e){let{sig:n,recovery:o}=t;const{canonical:i,der:a,recovered:s}=Object.assign({canonical:!0,der:!0},e);i&&n.hasHighS()&&(n=n.normalizeS(),o^=1);const r=a?n.toDERRawBytes():n.toCompactRawBytes();return s?[r,o]:r}async function nt(t,e,n={}){const{seed:o,m:i,d:a}=tt(t,e,n.extraEntropy);let s;const r=new H;await r.reseed(o);while(!(s=L(await r.generate(),i,a)))await r.reseed();return et(s,n)}function ot(t,e,n={}){const{seed:o,m:i,d:a}=tt(t,e,n.extraEntropy);let s;const r=new H;r.reseedSync(o);while(!(s=L(r.generateSync(),i,a)))r.reseedSync();return et(s,n)}const it={strict:!0};function at(t,e,n,o=it){let i;try{i=N(t),e=U(e)}catch(y){return!1}const{r:a,s}=i;if(o.strict&&i.hasHighS())return!1;const r=Z(e);let l;try{l=$(n)}catch(y){return!1}const{n:u}=c,h=C(s,u),d=M(r*h,u),m=M(a*h,u),f=p.BASE.multiplyAndAddUnsafe(l,d,m);if(!f)return!1;const w=M(f.x,u);return w===a}function st(t){return M(T(t),c.n)}function rt(t){return(t.y&i)===o}class lt{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromHex(t){const e=U(t);if(64!==e.length)throw new TypeError(`SchnorrSignature.fromHex: expected 64 bytes, not ${e.length}`);const n=T(e.subarray(0,32)),o=T(e.subarray(32,64));return new lt(n,o)}assertValidity(){const{r:t,s:e}=this;if(!O(t)||!z(e))throw new Error("Invalid signature")}toHex(){return S(this.r)+S(this.s)}toRawBytes(){return I(this.toHex())}}function ct(t){return p.fromPrivateKey(t).toRawX()}function ut(t,e,n){if(null==t)throw new TypeError(`sign: Expected valid message, not "${t}"`);const o=U(t),i=Q(e),a=U(n);if(32!==a.length)throw new TypeError("sign: Expected 32 bytes of aux randomness");const s=p.fromPrivateKey(i),r=s.toRawX(),l=rt(s)?i:c.n-i;return{m:o,P:s,px:r,d:l,rand:a}}function ht(t,e){return _(t^T(e))}function dt(t){const e=M(T(t),c.n);if(e===o)throw new Error("sign: Creation of signature failed. k is zero");const n=p.fromPrivateKey(e),i=n.toRawX(),a=rt(n)?e:c.n-e;return{R:n,rx:i,k:a}}function mt(t,e,n,o){return new lt(t.x,M(e+n*o,c.n)).toRawBytes()}async function pt(t,e,n=_t.randomBytes()){const{m:o,px:i,d:a,rand:s}=ut(t,e,n),r=ht(a,await _t.taggedHash(Dt.aux,s)),{R:l,rx:c,k:u}=dt(await _t.taggedHash(Dt.nonce,r,i,o)),h=st(await _t.taggedHash(Dt.challenge,c,i,o)),d=mt(l,u,h,a),m=await gt(d,o,i);if(!m)throw new Error("sign: Invalid signature produced");return d}function ft(t,e,n=_t.randomBytes()){const{m:o,px:i,d:a,rand:s}=ut(t,e,n),r=ht(a,_t.taggedHashSync(Dt.aux,s)),{R:l,rx:c,k:u}=dt(_t.taggedHashSync(Dt.nonce,r,i,o)),h=st(_t.taggedHashSync(Dt.challenge,c,i,o)),d=mt(l,u,h,a),m=vt(d,o,i);if(!m)throw new Error("sign: Invalid signature produced");return d}function wt(t,e,n){const o=t instanceof lt,i=o?t:lt.fromHex(t);return o&&i.assertValidity(),{...i,m:U(e),P:$(n)}}function yt(t,e,n,o){const i=p.BASE.multiplyAndAddUnsafe(e,Q(n),M(-o,c.n));return!(!i||!rt(i)||i.x!==t)}async function gt(t,e,n){try{const{r:o,s:i,m:a,P:s}=wt(t,e,n),r=st(await _t.taggedHash(Dt.challenge,_(o),s.toRawX(),a));return yt(o,s,i,r)}catch(o){return!1}}function vt(t,e,n){try{const{r:o,s:i,m:a,P:s}=wt(t,e,n),r=st(_t.taggedHashSync(Dt.challenge,_(o),s.toRawX(),a));return yt(o,s,i,r)}catch(o){return!1}}const kt={Signature:lt,getPublicKey:ct,sign:pt,verify:gt,signSync:ft,verifySync:vt};p.BASE._setWindowSize(8);const bt={node:n,web:"object"===typeof self&&"crypto"in self?self.crypto:void 0},Dt={challenge:"BIP0340/challenge",aux:"BIP0340/aux",nonce:"BIP0340/nonce"},St={},_t={isValidPrivateKey(t){try{return Q(t),!0}catch(e){return!1}},privateAdd:(t,e)=>{const n=Q(t),o=Q(e);return _(M(n+o,c.n))},privateNegate:t=>{const e=Q(t);return _(c.n-e)},pointAddScalar:(t,e,n)=>{const o=p.fromHex(t),a=Q(e),s=p.BASE.multiplyAndAddUnsafe(o,a,i);if(!s)throw new Error("Tweaked point at infinity");return s.toRawBytes(n)},pointMultiply:(t,e,n)=>{const o=p.fromHex(t),i=T(U(e));return o.multiply(i).toRawBytes(n)},hashToPrivateKey:t=>{if(t=U(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const e=M(T(t),c.n-i)+i;return _(e)},randomBytes:(t=32)=>{if(bt.web)return bt.web.getRandomValues(new Uint8Array(t));if(bt.node){const{randomBytes:e}=bt.node;return Uint8Array.from(e(t))}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>_t.hashToPrivateKey(_t.randomBytes(40)),bytesToHex:D,hexToBytes:I,concatBytes:v,mod:M,invert:C,sha256:async(...t)=>{if(bt.web){const e=await bt.web.subtle.digest("SHA-256",v(...t));return new Uint8Array(e)}if(bt.node){const{createHash:e}=bt.node,n=e("sha256");return t.forEach((t=>n.update(t))),Uint8Array.from(n.digest())}throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(t,...e)=>{if(bt.web){const n=await bt.web.subtle.importKey("raw",t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),o=v(...e),i=await bt.web.subtle.sign("HMAC",n,o);return new Uint8Array(i)}if(bt.node){const{createHmac:n}=bt.node,o=n("sha256",t);return e.forEach((t=>o.update(t))),Uint8Array.from(o.digest())}throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(t,...e)=>{let n=St[t];if(void 0===n){const e=await _t.sha256(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=v(e,e),St[t]=n}return _t.sha256(n,...e)},taggedHashSync:(t,...e)=>{if("function"!==typeof _t.sha256Sync)throw new Error("utils.sha256Sync is undefined, you need to set it");let n=St[t];if(void 0===n){const e=_t.sha256Sync(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=v(e,e),St[t]=n}return _t.sha256Sync(n,...e)},precompute(t=8,e=p.BASE){const n=e===p.BASE?e:new p(e.x,e.y);return n._setWindowSize(t),n.multiply(s),n}};t.CURVE=c,t.Point=p,t.Signature=g,t.getPublicKey=j,t.getSharedSecret=J,t.recoverPublicKey=K,t.schnorr=kt,t.sign=nt,t.signSync=ot,t.utils=_t,t.verify=at,Object.defineProperty(t,"__esModule",{value:!0})}))},1722:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>On});var o=n(9835),i=n(6970),a=n(1957);const s={class:"row q-col-gutter-y-md justify-center q-pt-sm q-pb-md"},r={class:"col-12 col-sm-11 col-md-8 text-center q-gutter-y-md"},l={class:"row items-center no-wrap q-mb-sm"},c={class:"col-6 col-sm-5 col-md-4 q-pr-xs"},u=(0,o._)("div",{class:"col-0 col-sm-2 col-md-4"},null,-1),h={class:"col-6 col-sm-5 col-md-4 q-pl-xs"},d={style:{"margin-bottom":"7rem"}},m={class:"row q-pt-sm"},p={class:"col-4 q-pt-none"},f=(0,o._)("strong",null,"Create Invoice",-1),w={class:"col-4 q-pt-xs"},y={align:"center"},g=(0,o._)("b",null,"Install",-1),v={class:"col-4 q-pt-none"},k=(0,o._)("strong",null,"Pay Invoice",-1),b={key:0,class:"q-col-gutter"},D={key:0},S={class:"q-my-none"},_={class:"text-wrap"},q={key:0},x=(0,o._)("br",null,null,-1),I=(0,o._)("strong",null,"Expire date:",-1),T=(0,o._)("br",null,null,-1),U=(0,o._)("strong",null,"Hash:",-1),W={class:"col-12"},M={key:0,class:"row q-mt-lg"},P={key:1,class:"row q-mt-lg"},A={key:1},C={key:0,class:"q-my-none text-h6 text-center"},E={key:1,class:"q-my-none text-h6 text-center"},B=(0,o._)("br",null,null,-1),V={key:2,class:"row"},R={class:"col text-justify text-italic"},Z={key:0,class:"col-4 q-pl-md"},H={class:"row"},z={class:"col"},O={key:0,class:"col-8 q-pl-md"},L={class:"row q-mt-lg"},Q={key:2},$={class:"row q-mt-lg"},N={class:"text-center q-mb-lg"},j={class:"row q-mt-lg"},K=(0,o._)("img",{src:"https://raw.githubusercontent.com/cashubtc/cashu-ui/main/ui/icons/circle/128x128.png"},null,-1),F=(0,o._)("span",{class:"text-weight-bold"},"Cashu",-1),J=(0,o._)("p",null,"Please take a moment to read the following information.",-1),Y=(0,o._)("p",null,[(0,o._)("strong",null,"Open this wallet on your device's native browser"),(0,o.Uk)(" Cashu stores your ecash on your device locally. For the best experience, use this wallet with your device's native web browser (for example Safari for iOS, Chrome for Android). ")],-1),G=(0,o._)("p",null,[(0,o._)("strong",null,"Add to home screen."),(0,o.Uk)(" Add Cashu to your home screen as a progressive web app (PWA). On Android Chrome, click the hamburger menu at the upper right. On iOS Safari, click the share button. Now press the Add to Home screen button. ")],-1),X=(0,o._)("p",null,[(0,o._)("strong",null,"This software is in BETA!"),(0,o.Uk)(" We hold no responsibility for people losing access to funds. Use at your own risk! Ecash is a bearer asset, meaning losing access to this wallet will mean you will lose the funds. This wallet stores ecash tokens in its database. If you lose the link or delete your your data without backing up, you will lose your tokens. Press the Backup button to download a copy of your tokens. ")],-1),tt={class:"row q-mt-lg"},et=(0,o._)("h6",{class:"q-my-md text-primary"},"Warning",-1),nt=(0,o._)("p",null,[(0,o._)("strong",null,"Bookmark this page and backup your tokens!"),(0,o.Uk)(" Ecash is a bearer asset. Losing access to this wallet will mean you will lose your funds. This wallet stores ecash tokens locally on your device. If you lose the link or delete your your data without backing up, you will lose your tokens. Press the Backup button to download a copy of your tokens. ")],-1),ot=(0,o._)("p",null,[(0,o._)("strong",null,"Where is my old wallet"),(0,o.Uk)(" This wallet was previously running on https://legend.lnbits.com/cashu/wallet but has since moved to https://wallet.cashu.me. Send all tokens from the old wallet to this one. ")],-1),it=(0,o._)("p",null,[(0,o._)("strong",null,"Add to home screen."),(0,o.Uk)(" You can add Cashu to your home screen as a progressive web app (PWA). On Android Chrome, click the hamburger menu at the upper right. On iOS Safari, click the share button. Now press the Add to Home screen button. ")],-1),at=(0,o._)("p",null,[(0,o._)("strong",null,"This software is in BETA!"),(0,o.Uk)(" We hold no responsibility for people losing access to funds. Use at your own risk! ")],-1),st={class:"row q-mt-lg"},rt={key:0},lt=(0,o._)("div",{class:"row items-center no-wrap q-mb-sm"},[(0,o._)("div",{class:"col-12"},[(0,o._)("span",{class:"text-subtitle1"},"Create a Lightning invoice")])],-1),ct={class:"row items-center no-wrap q-my-sm q-py-none"},ut={class:"col-12"},ht={key:1,class:"text-center q-mb-lg q-mt-none q-pt-none"},dt=["href"],mt={class:"row q-mt-lg"},pt={key:0},ft=(0,o._)("div",{class:"row items-center no-wrap q-mb-sm"},[(0,o._)("div",{class:"col-12"},[(0,o._)("span",{class:"text-subtitle1"},"Send ecash")])],-1),wt={class:"row items-center no-wrap q-my-sm q-py-none"},yt={class:"col-12"},gt={key:1,class:"text-center q-mb-lg"},vt={key:0,class:"text-center q-mb-lg"},kt={class:"row"},bt={class:"col-12"},Dt={class:"row"},St={class:"col-12"},_t={class:"row"},qt={class:"col-12"},xt={class:"row q-mt-lg"},It={key:1},Tt=(0,o._)("div",{class:"row items-center no-wrap q-mb-sm"},[(0,o._)("div",{class:"col-12"},[(0,o._)("span",{class:"text-subtitle1"},"Receive Ecash")])],-1),Ut={key:0,class:"row"},Wt={class:"col-12"},Mt={class:"row q-mt-lg"};function Pt(t,e,n,Pt,At,Ct){const Et=(0,o.up)("NoMintWarnBanner"),Bt=(0,o.up)("BalanceView"),Vt=(0,o.up)("q-btn"),Rt=(0,o.up)("q-tab"),Zt=(0,o.up)("q-tabs"),Ht=(0,o.up)("HistoryTable"),zt=(0,o.up)("q-tab-panel"),Ot=(0,o.up)("InvoicesTable"),Lt=(0,o.up)("SettingsView"),Qt=(0,o.up)("q-tab-panels"),$t=(0,o.up)("q-card-section"),Nt=(0,o.up)("q-card"),jt=(0,o.up)("q-tooltip"),Kt=(0,o.up)("q-separator"),Ft=(0,o.up)("ChooseMint"),Jt=(0,o.up)("q-spinner-tail"),Yt=(0,o.up)("q-img"),Gt=(0,o.up)("q-input"),Xt=(0,o.up)("q-form"),te=(0,o.up)("q-dialog"),ee=(0,o.up)("qrcode-stream"),ne=(0,o.up)("q-avatar"),oe=(0,o.up)("q-toolbar-title"),ie=(0,o.up)("q-toolbar"),ae=(0,o.up)("vue-qrcode"),se=(0,o.up)("q-responsive"),re=(0,o.up)("q-toggle"),le=(0,o.up)("TokenInformation"),ce=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)("div",s,[(0,o._)("div",r,[0==t.mints.length?((0,o.wg)(),(0,o.j4)(Et,{key:0})):((0,o.wg)(),(0,o.j4)(Bt,{key:1,proofs:t.proofs,"active-proofs":t.activeProofs,mints:t.mints,"ticker-short":t.tickerShort,"active-mint-url":t.activeMintUrl,"pending-balance":Ct.pendingBalance,"check-pending-tokens":Ct.checkPendingTokens,"set-tab":Ct.setTab},null,8,["proofs","active-proofs","mints","ticker-short","active-mint-url","pending-balance","check-pending-tokens","set-tab"])),(0,o.Wm)(Nt,{class:"q-mt-xs"},{default:(0,o.w5)((()=>[(0,o.Wm)($t,{class:"q-pt-sm"},{default:(0,o.w5)((()=>[(0,o._)("div",l,[(0,o._)("div",c,[(0,o.Wm)(Vt,{size:"0.75rem",rectangle:"",unelevated:"",dense:"",color:"primary",align:"between",icon:"file_download","icon-right":"toll",class:"full-width",onClick:Ct.showReceiveTokensDialog},{default:(0,o.w5)((()=>[(0,o.Uk)("Receive Ecash")])),_:1},8,["onClick"])]),u,(0,o._)("div",h,[(0,o.Wm)(Vt,{size:"0.75rem",rectangle:"",unelevated:"",dense:"",align:"between",color:"primary",icon:"file_upload","icon-right":"toll",class:"full-width",onClick:Ct.showSendTokensDialog},{default:(0,o.w5)((()=>[(0,o.Uk)(" Send Ecash")])),_:1},8,["onClick"])])]),(0,o.Wm)(Zt,{modelValue:t.tab,"onUpdate:modelValue":e[0]||(e[0]=e=>t.tab=e),"no-caps":"",class:"bg-dark text-white"},{default:(0,o.w5)((()=>[(0,o.Wm)(Rt,{name:"history",label:"History"}),(0,o.Wm)(Rt,{name:"invoices",label:"Invoices"}),(0,o.Wm)(Rt,{name:"settings",label:"Settings"})])),_:1},8,["modelValue"]),(0,o.Wm)(Qt,{modelValue:t.tab,"onUpdate:modelValue":e[1]||(e[1]=e=>t.tab=e),animated:""},{default:(0,o.w5)((()=>[(0,o.Wm)(zt,{name:"history"},{default:(0,o.w5)((()=>[(0,o.Wm)(Ht,{"history-tokens":t.historyTokens,"show-token-dialog":Ct.showTokenDialog,"check-token-spendable":Ct.checkTokenSpendable},null,8,["history-tokens","show-token-dialog","check-token-spendable"])])),_:1}),(0,o.Wm)(zt,{name:"invoices"},{default:(0,o.w5)((()=>[(0,o.Wm)(Ot,{"invoice-history":t.invoiceHistory,"show-invoice-info-dialog":Ct.showInvoicInfoDialog,"check-invoice":Ct.checkInvoice},null,8,["invoice-history","show-invoice-info-dialog","check-invoice"])])),_:1}),(0,o.Wm)(zt,{name:"settings",class:"q-px-sm"},{default:(0,o.w5)((()=>[(0,o.Wm)(Lt,{proofs:t.proofs,"active-proofs":t.activeProofs,mints:t.mints,"ticker-short":t.tickerShort,"active-mint-url":t.activeMintUrl,"add-mint":Ct.addMint,"remove-mint":Ct.removeMint,"activate-mint":Ct.activateMint,"request-mint":Ct.requestMint,"decode-request":Ct.decodeRequest,melt:Ct.melt,"invoice-check-worker":Ct.invoiceCheckWorker,"pay-invoice-data":t.payInvoiceData,"show-mint-dialog":this.addMintDialog.show,"mint-to-add-wallet-page":this.addMintDialog.mintToAdd},null,8,["proofs","active-proofs","mints","ticker-short","active-mint-url","add-mint","remove-mint","activate-mint","request-mint","decode-request","melt","invoice-check-worker","pay-invoice-data","show-mint-dialog","mint-to-add-wallet-page"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,o._)("div",d,[(0,o._)("div",m,[(0,o._)("div",p,[(0,o.Wm)(Vt,{class:"full-width gt-sm",size:"1.0rem","icon-right":"bolt",icon:"file_download",align:"between",rectangle:"",color:"primary",onClick:Ct.showInvoiceCreateDialog},{default:(0,o.w5)((()=>[f])),_:1},8,["onClick"])]),(0,o._)("div",w,[(0,o._)("div",y,[(0,o.Wm)(Vt,{class:"q-mx-xs q-px-sm q-my-sm",size:"0.6rem",rectangle:"",color:"warning",icon:"warning",outline:"",onClick:Ct.showDisclaimerDialog},{default:(0,o.w5)((()=>[(0,o.Wm)(jt,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Warning")])),_:1})])),_:1},8,["onClick"]),(0,o.Wm)(Vt,{class:"q-mx-xs q-px-sm q-my-sm",size:"0.6rem",outline:"",rectangle:"",color:"warning",icon:"download_for_offline",onClick:Ct.getLocalstorageToFile},{default:(0,o.w5)((()=>[(0,o.Wm)(jt,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Download wallet backup")])),_:1})])),_:1},8,["onClick"]),"browser"==Ct.getPWADisplayMode()&&null!=t.deferredPWAInstallPrompt?((0,o.wg)(),(0,o.j4)(Vt,{key:0,class:"q-mx-xs q-px-sm q-my-sm",outline:"",size:"0.6rem",color:"primary",onClick:e[2]||(e[2]=t=>Ct.triggerPWAInstall())},{default:(0,o.w5)((()=>[g,(0,o.Wm)(jt,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Install Cashu")])),_:1})])),_:1})):(0,o.kq)("",!0)])]),(0,o._)("div",v,[(0,o.Wm)(Vt,{class:"full-width gt-sm",onClick:Ct.showParseDialog,size:"1.0rem","icon-right":"bolt",icon:"file_upload",align:"between",rectangle:"",color:"primary"},{default:(0,o.w5)((()=>[k])),_:1},8,["onClick"])])])])]),t.welcomeDialog.show||t.showSendTokens||t.showInvoiceDetails||t.showReceiveTokens||t.payInvoiceData.show||t.disclaimerDialog.show||t.camera.show?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",b,[(0,o.Wm)(Zt,{class:"lt-md fixed-bottom q-px-none q-py-md left-0 right-0 bg-primary text-white shadow-2 z-top q-px-0","indicator-color":"transparent",align:"justify"},{default:(0,o.w5)((()=>[(0,o.Wm)(Rt,{class:"col-5",label:"Create Invoice",icon:"bolt",onClick:Ct.showInvoiceCreateDialog},null,8,["onClick"]),Ct.hasCamera?((0,o.wg)(),(0,o.j4)(Rt,{key:0,class:"col-2 q-pb-md",icon:"photo_camera",onClick:Ct.showCamera},null,8,["onClick"])):(0,o.kq)("",!0),(0,o.Wm)(Rt,{class:"col-5",icon:"bolt",onClick:Ct.showParseDialog,label:"Pay Invoice"},null,8,["onClick"])])),_:1})])),t.camera.show?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(te,{key:1,modelValue:t.payInvoiceData.show,"onUpdate:modelValue":e[6]||(e[6]=e=>t.payInvoiceData.show=e),onHide:Ct.closeParseDialog,position:"top"},{default:(0,o.w5)((()=>[(0,o.Wm)(Nt,{class:"q-pa-lg q-pt-xl qcard"},{default:(0,o.w5)((()=>[t.payInvoiceData.invoice?((0,o.wg)(),(0,o.iD)("div",D,[(0,o._)("h6",S," Pay "+(0,i.zw)(t.payInvoiceData.invoice.fsat)+" "+(0,i.zw)(t.tickerShort),1),(0,o.Wm)(Kt,{class:"q-my-sm"}),(0,o._)("p",_,[t.payInvoiceData.invoice.description?((0,o.wg)(),(0,o.iD)("strong",q,"Description:")):(0,o.kq)("",!0),(0,o.Uk)(" "+(0,i.zw)(t.payInvoiceData.invoice.description),1),x,I,(0,o.Uk)(" "+(0,i.zw)(t.payInvoiceData.invoice.expireDate),1),T,U,(0,o.Uk)(" "+(0,i.zw)(t.payInvoiceData.invoice.hash),1)]),(0,o._)("div",W,[(0,o.Wm)(Ft,{proofs:t.proofs,"active-proofs":t.activeProofs,mints:t.mints,"ticker-short":t.tickerShort,"active-mint-url":t.activeMintUrl,"activate-mint":Ct.activateMint},null,8,["proofs","active-proofs","mints","ticker-short","active-mint-url","activate-mint"])]),Ct.canPay?((0,o.wg)(),(0,o.iD)("div",M,[(0,o.Wm)(Vt,{unelevated:"",color:"primary",disabled:t.payInvoiceData.blocking,onClick:Ct.melt,label:t.payInvoiceData.blocking?"Paying...":"Pay"},{default:(0,o.w5)((()=>[t.payInvoiceData.blocking?((0,o.wg)(),(0,o.j4)(Jt,{key:0,color:"white",size:"1em"})):(0,o.kq)("",!0)])),_:1},8,["disabled","onClick","label"]),(0,o.wy)(((0,o.wg)(),(0,o.j4)(Vt,{flat:"",color:"grey",class:"q-ml-auto"},{default:(0,o.w5)((()=>[(0,o.Uk)("Cancel")])),_:1})),[[ce]])])):((0,o.wg)(),(0,o.iD)("div",P,[(0,o.Wm)(Vt,{unelevated:"",disabled:"",color:"yellow","text-color":"black"},{default:(0,o.w5)((()=>[(0,o.Uk)("Not enough funds!")])),_:1}),(0,o.wy)(((0,o.wg)(),(0,o.j4)(Vt,{flat:"",color:"grey",class:"q-ml-auto"},{default:(0,o.w5)((()=>[(0,o.Uk)("Cancel")])),_:1})),[[ce]])]))])):t.payInvoiceData.lnurlpay?((0,o.wg)(),(0,o.iD)("div",A,[(0,o.Wm)(Xt,{onSubmit:Ct.lnurlPaySecond,class:"q-gutter-md"},{default:(0,o.w5)((()=>[t.payInvoiceData.lnurlpay.maxSendable==t.payInvoiceData.lnurlpay.minSendable?((0,o.wg)(),(0,o.iD)("p",C,[(0,o._)("b",null,(0,i.zw)(t.payInvoiceData.domain),1),(0,o.Uk)(" is requesting "+(0,i.zw)(t.payInvoiceData.lnurlpay.maxSendable/1e3)+" "+(0,i.zw)(t.tickerShort),1)])):((0,o.wg)(),(0,o.iD)("p",E,[(0,o._)("b",null,(0,i.zw)(t.payInvoiceData.lnurlpay.targetUser||t.payInvoiceData.domain),1),(0,o.Uk)(" is requesting "),B,(0,o.Uk)(" between "),(0,o._)("b",null,(0,i.zw)(t.payInvoiceData.lnurlpay.minSendable/1e3),1),(0,o.Uk)(" and "),(0,o._)("b",null,(0,i.zw)(t.payInvoiceData.lnurlpay.maxSendable/1e3),1),(0,o.Uk)(" "+(0,i.zw)(t.tickerShort)+" ",1)])),(0,o.Wm)(Kt,{class:"q-my-sm"}),t.payInvoiceData.lnurlpay.description?((0,o.wg)(),(0,o.iD)("div",V,[(0,o._)("p",R,(0,i.zw)(t.payInvoiceData.lnurlpay.description),1),t.payInvoiceData.lnurlpay.image?((0,o.wg)(),(0,o.iD)("p",Z,[(0,o.Wm)(Yt,{src:t.payInvoiceData.lnurlpay.image},null,8,["src"])])):(0,o.kq)("",!0)])):(0,o.kq)("",!0),(0,o._)("div",H,[(0,o._)("div",z,[(0,o.Wm)(Gt,{filled:"",dense:"",autofocus:"",modelValue:t.payInvoiceData.data.amount,"onUpdate:modelValue":e[3]||(e[3]=e=>t.payInvoiceData.data.amount=e),modelModifiers:{number:!0},type:"number",label:"Amount ("+t.tickerShort+") *",min:t.payInvoiceData.lnurlpay.minSendable/1e3,max:t.payInvoiceData.lnurlpay.maxSendable/1e3,readonly:t.payInvoiceData.lnurlpay.maxSendable==t.payInvoiceData.lnurlpay.minSendable},null,8,["modelValue","label","min","max","readonly"])]),t.payInvoiceData.lnurlpay.commentAllowed>0?((0,o.wg)(),(0,o.iD)("div",O,[(0,o.Wm)(Gt,{filled:"",dense:"",modelValue:t.payInvoiceData.data.comment,"onUpdate:modelValue":e[4]||(e[4]=e=>t.payInvoiceData.data.comment=e),_type:"payInvoiceData.lnurlpay.commentAllowed > 64 ? 'textarea' : 'text'",label:"Comment (optional)",maxlength:t.payInvoiceData.lnurlpay.commentAllowed},null,8,["modelValue","maxlength"])])):(0,o.kq)("",!0)]),(0,o._)("div",L,[(0,o.Wm)(Vt,{unelevated:"",color:"primary",type:"submit"},{default:(0,o.w5)((()=>[(0,o.Uk)("Send")])),_:1}),(0,o.wy)(((0,o.wg)(),(0,o.j4)(Vt,{flat:"",color:"grey",class:"q-ml-auto"},{default:(0,o.w5)((()=>[(0,o.Uk)("Cancel")])),_:1})),[[ce]])])])),_:1},8,["onSubmit"])])):((0,o.wg)(),(0,o.iD)("div",Q,[t.camera.show?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(Xt,{key:0,onSubmit:Ct.decodeRequest,class:"q-gutter-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(Gt,{ref:"pasteInput",filled:"",dense:"",modelValue:t.payInvoiceData.data.request,"onUpdate:modelValue":e[5]||(e[5]=e=>t.payInvoiceData.data.request=e),modelModifiers:{trim:!0},type:"textarea",label:"Enter a Lightning invoice, an LNURL, or a Lightning address"},null,8,["modelValue"]),(0,o._)("div",$,[(0,o.Wm)(Vt,{unelevated:"",color:"primary",disable:""==t.payInvoiceData.data.request,type:"submit"},{default:(0,o.w5)((()=>[(0,o.Uk)("Enter")])),_:1},8,["disable"]),Ct.hasCamera?((0,o.wg)(),(0,o.j4)(Vt,{key:0,unelevated:"",icon:"photo_camera",class:"q-mx-0",onClick:Ct.showCamera},null,8,["onClick"])):(0,o.kq)("",!0),(0,o.wy)(((0,o.wg)(),(0,o.j4)(Vt,{flat:"",color:"grey",class:"q-ml-auto"},{default:(0,o.w5)((()=>[(0,o.Uk)("Close")])),_:1})),[[ce]])])])),_:1},8,["onSubmit"]))]))])),_:1})])),_:1},8,["modelValue","onHide"])),(0,o.Wm)(te,{modelValue:t.camera.show,"onUpdate:modelValue":e[7]||(e[7]=e=>t.camera.show=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(Nt,{class:"q-pa-lg q-pt-xl"},{default:(0,o.w5)((()=>[(0,o._)("div",N,[(0,o.Wm)(ee,{onDecode:Ct.decodeQR,class:"rounded-borders"},null,8,["onDecode"])]),(0,o._)("div",j,[(0,o.Wm)(Vt,{onClick:Ct.closeCamera,flat:"",color:"grey",class:"q-ml-auto"},{default:(0,o.w5)((()=>[(0,o.Uk)("Cancel")])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(te,{class:"z-top",persistent:"",modelValue:t.welcomeDialog.show,"onUpdate:modelValue":e[11]||(e[11]=e=>t.welcomeDialog.show=e),position:"top"},{default:(0,o.w5)((()=>[(0,o.Wm)(Nt,{class:"q-pa-lg z-top"},{default:(0,o.w5)((()=>[(0,o.Wm)(ie,null,{default:(0,o.w5)((()=>[(0,o.Wm)(ne,null,{default:(0,o.w5)((()=>[K])),_:1}),(0,o.Wm)(oe,null,{default:(0,o.w5)((()=>[F,(0,o.Uk)(" wallet")])),_:1})])),_:1}),(0,o.Wm)($t,null,{default:(0,o.w5)((()=>[J,Y,G,X,(0,o._)("div",tt,["browser"==Ct.getPWADisplayMode()&&null!=t.deferredPWAInstallPrompt?((0,o.wg)(),(0,o.j4)(Vt,{key:0,outline:"",class:"q-mx-sm",color:"primary",onClick:e[8]||(e[8]=t=>Ct.triggerPWAInstall())},{default:(0,o.w5)((()=>[(0,o.Uk)("Install Cashu")])),_:1})):(0,o.kq)("",!0),(0,o.Wm)(Vt,{outline:"",color:"grey",class:"q-mx-sm",onClick:e[9]||(e[9]=e=>t.copyText(t.baseURL))},{default:(0,o.w5)((()=>[(0,o.Uk)("Copy URL")])),_:1}),(0,o.wy)(((0,o.wg)(),(0,o.j4)(Vt,{flat:"",color:"primary",class:"q-ml-auto",onClick:e[10]||(e[10]=t=>Ct.setWelcomeDialogSeen())},{default:(0,o.w5)((()=>[(0,o.Uk)("Continue")])),_:1})),[[ce]])])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(te,{modelValue:t.disclaimerDialog.show,"onUpdate:modelValue":e[13]||(e[13]=e=>t.disclaimerDialog.show=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(Nt,{class:"q-pa-lg"},{default:(0,o.w5)((()=>[et,nt,ot,it,at,(0,o._)("div",st,[(0,o.Wm)(Vt,{outline:"",color:"grey",onClick:e[12]||(e[12]=e=>t.copyText(t.disclaimerDialog.location.href))},{default:(0,o.w5)((()=>[(0,o.Uk)("Copy wallet URL")])),_:1}),(0,o.wy)(((0,o.wg)(),(0,o.j4)(Vt,{flat:"",color:"grey",class:"q-ml-auto"},{default:(0,o.w5)((()=>[(0,o.Uk)("I understand")])),_:1})),[[ce]])])])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(te,{modelValue:t.showInvoiceDetails,"onUpdate:modelValue":e[16]||(e[16]=e=>t.showInvoiceDetails=e),position:"top"},{default:(0,o.w5)((()=>[(0,o.Wm)(Nt,{class:"q-pa-lg q-pt-md qcard"},{default:(0,o.w5)((()=>[t.invoiceData.bolt11?((0,o.wg)(),(0,o.iD)("div",ht,[(0,o._)("a",{class:"text-secondary",href:"lightning:"+t.invoiceData.bolt11},[(0,o.Wm)(se,{ratio:1,class:"q-mx-md q-mt-none q-pt-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(ae,{value:"lightning:"+t.invoiceData.bolt11.toUpperCase(),options:{width:340},class:"rounded-borders"},null,8,["value"])])),_:1})],8,dt)])):((0,o.wg)(),(0,o.iD)("div",rt,[lt,(0,o._)("div",ct,[(0,o._)("div",ut,[(0,o.Wm)(Ft,{proofs:t.proofs,"active-proofs":t.activeProofs,mints:t.mints,"ticker-short":t.tickerShort,"active-mint-url":t.activeMintUrl,"activate-mint":Ct.activateMint},null,8,["proofs","active-proofs","mints","ticker-short","active-mint-url","activate-mint"])])]),(0,o.Wm)(Gt,{filled:"",dense:"",type:"number",modelValue:t.invoiceData.amount,"onUpdate:modelValue":e[14]||(e[14]=e=>t.invoiceData.amount=e),modelModifiers:{number:!0},label:"Amount ("+t.tickerShort+") *",mask:"#","fill-mask":"0","reverse-fill-mask":"",autofocus:"",class:"q-mb-lg",onKeyup:(0,a.D2)(Ct.requestMintButton,["enter"])},null,8,["modelValue","label","onKeyup"])])),(0,o._)("div",mt,[t.invoiceData.bolt11?((0,o.wg)(),(0,o.j4)(Vt,{key:0,onClick:e[15]||(e[15]=e=>t.copyText(t.invoiceData.bolt11)),outline:"",color:"primary"},{default:(0,o.w5)((()=>[(0,o.Uk)("Copy invoice")])),_:1})):((0,o.wg)(),(0,o.j4)(Vt,{key:1,color:"primary",onClick:Ct.requestMintButton,disable:!t.invoiceData.amount>0},{default:(0,o.w5)((()=>[(0,o.Uk)("Create Invoice")])),_:1},8,["onClick","disable"])),(0,o.wy)(((0,o.wg)(),(0,o.j4)(Vt,{flat:"",color:"grey",class:"q-ml-auto"},{default:(0,o.w5)((()=>[(0,o.Uk)("Close")])),_:1})),[[ce]])])])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(te,{modelValue:t.showSendTokens,"onUpdate:modelValue":e[23]||(e[23]=e=>t.showSendTokens=e),position:"top"},{default:(0,o.w5)((()=>[(0,o.Wm)(Nt,{class:"q-pa-lg q-pt-md qcard"},{default:(0,o.w5)((()=>[t.sendData.tokens?((0,o.wg)(),(0,o.iD)("div",gt,[t.sendData.tokens.length<2?((0,o.wg)(),(0,o.iD)("div",vt,[(0,o.Wm)(se,{ratio:1,class:"q-mx-xl"},{default:(0,o.w5)((()=>[(0,o.Wm)(ae,{value:t.baseURL+"?token="+t.sendData.tokensBase64,options:{width:340},class:"rounded-borders"},null,8,["value"])])),_:1})])):(0,o.kq)("",!0),(0,o._)("div",kt,[(0,o._)("div",bt,[(0,o.Wm)(re,{class:"float-right",modelValue:t.showSendTokenLegacyV2TokenToggleState,"onUpdate:modelValue":e[18]||(e[18]=e=>t.showSendTokenLegacyV2TokenToggleState=e),color:"pink",icon:"bedtime",label:"Old token format",onClick:e[19]||(e[19]=t=>Ct.sendTokenDialogSwitchTokenV3ToLegacyV2())},null,8,["modelValue"])])]),(0,o._)("div",Dt,[(0,o._)("div",St,[(0,o.Wm)(Gt,{outlined:"",dense:"",readonly:"",modelValue:t.sendData.tokensBase64,"onUpdate:modelValue":e[20]||(e[20]=e=>t.sendData.tokensBase64=e),label:"Cashu token",type:"textarea",class:"q-mb-sm"},null,8,["modelValue"])])]),(0,o._)("div",_t,[(0,o._)("div",qt,[(0,o.Wm)(le,{proofs:t.proofs,"active-proofs":t.activeProofs,mints:t.mints,"ticker-short":t.tickerShort,"active-mint-url":t.activeMintUrl,"proofs-to-show":t.sendData.tokens,"token-mint-url":Ct.getMint(Ct.decodeToken(t.sendData.tokensBase64))},null,8,["proofs","active-proofs","mints","ticker-short","active-mint-url","proofs-to-show","token-mint-url"])])])])):((0,o.wg)(),(0,o.iD)("div",pt,[ft,(0,o._)("div",wt,[(0,o._)("div",yt,[(0,o.Wm)(Ft,{proofs:t.proofs,"active-proofs":t.activeProofs,mints:t.mints,"ticker-short":t.tickerShort,"active-mint-url":t.activeMintUrl,"activate-mint":Ct.activateMint},null,8,["proofs","active-proofs","mints","ticker-short","active-mint-url","activate-mint"])])]),(0,o.Wm)(Gt,{filled:"",dense:"",type:"number",modelValue:t.sendData.amount,"onUpdate:modelValue":e[17]||(e[17]=e=>t.sendData.amount=e),modelModifiers:{number:!0},label:"Amount ("+t.tickerShort+") *",mask:"#","fill-mask":"0","reverse-fill-mask":"",autofocus:"",class:"q-mb-lg",onKeyup:(0,a.D2)(Ct.sendTokens,["enter"])},null,8,["modelValue","label","onKeyup"])])),(0,o._)("div",xt,[t.sendData.tokens?((0,o.wg)(),(0,o.iD)("div",It,[(0,o.Wm)(Vt,{class:"q-mx-xs",color:"primary",onClick:e[21]||(e[21]=e=>t.copyText(t.sendData.tokensBase64))},{default:(0,o.w5)((()=>[(0,o.Uk)("Copy token")])),_:1}),(0,o.Wm)(Vt,{class:"q-mx-xs",color:"primary",outline:"",onClick:e[22]||(e[22]=e=>t.copyText(t.baseURL+"?token="+t.sendData.tokensBase64))},{default:(0,o.w5)((()=>[(0,o.Uk)("Copy link")])),_:1})])):((0,o.wg)(),(0,o.j4)(Vt,{key:0,disable:null==t.sendData.amount||t.sendData.amount<=0,onClick:Ct.sendTokens,color:"primary",type:"submit"},{default:(0,o.w5)((()=>[(0,o.Uk)("Send Tokens")])),_:1},8,["disable","onClick"])),(0,o.wy)(((0,o.wg)(),(0,o.j4)(Vt,{flat:"",color:"grey",class:"q-ml-auto"},{default:(0,o.w5)((()=>[(0,o.Uk)("Close")])),_:1})),[[ce]])])])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(te,{modelValue:t.showReceiveTokens,"onUpdate:modelValue":e[25]||(e[25]=e=>t.showReceiveTokens=e),position:"top"},{default:(0,o.w5)((()=>[(0,o.Wm)(Nt,{class:"q-pa-lg q-pt-md qcard"},{default:(0,o.w5)((()=>[(0,o._)("div",null,[Tt,(0,o.Wm)(Gt,{filled:"",dense:"",modelValue:t.receiveData.tokensBase64,"onUpdate:modelValue":e[24]||(e[24]=e=>t.receiveData.tokensBase64=e),label:"Enter Cashu token",type:"textarea",autofocus:"",class:"q-mb-lg"},null,8,["modelValue"])]),t.receiveData.tokensBase64.length&&""!=Ct.decodeToken(t.receiveData.tokensBase64)?((0,o.wg)(),(0,o.iD)("div",Ut,[(0,o._)("div",Wt,[(0,o.Wm)(le,{proofs:t.proofs,"active-proofs":t.activeProofs,mints:t.mints,"ticker-short":t.tickerShort,"active-mint-url":t.activeMintUrl,"proofs-to-show":Ct.getProofs(Ct.decodeToken(t.receiveData.tokensBase64)),"token-mint-url":Ct.getMint(Ct.decodeToken(t.receiveData.tokensBase64))},null,8,["proofs","active-proofs","mints","ticker-short","active-mint-url","proofs-to-show","token-mint-url"])])])):(0,o.kq)("",!0),(0,o._)("div",Mt,[(0,o.Wm)(Vt,{onClick:Ct.redeem,color:"primary",disabled:!Ct.decodeToken(t.receiveData.tokensBase64)},{default:(0,o.w5)((()=>[(0,o.Uk)("Receive")])),_:1},8,["onClick","disabled"]),Ct.hasCamera?((0,o.wg)(),(0,o.j4)(Vt,{key:0,unelevated:"",icon:"photo_camera",class:"q-mx-0",onClick:Ct.showCamera},null,8,["onClick"])):(0,o.kq)("",!0),(0,o.wy)(((0,o.wg)(),(0,o.j4)(Vt,{flat:"",color:"grey",class:"q-ml-auto"},{default:(0,o.w5)((()=>[(0,o.Uk)("Close")])),_:1})),[[ce]])])])),_:1})])),_:1},8,["modelValue"])])}n(6204),n(9665);var At=n(499),Ct=n(3340),Et=n(7524);(0,Ct.xr)((({app:t})=>{t.config.globalProperties.$axios=Et.Z}));var Bt=n(4376),Vt=n(1735);function Rt(t){const e=[];for(let n=0;n<32;n++){const o=1<<n;0!==(t&o)&&e.push(Math.pow(2,n))}return e}function Zt(t){return zt(Vt.utils.bytesToHex(t))}function Ht(t,e){return"bigint"===typeof e?e.toString():e}function zt(t){if("string"!==typeof t)throw new TypeError("hexToNumber: expected string, got "+typeof t);return BigInt(`0x${t}`)}n(5231),n(3075),n(548),n(2079),n(8218),n(6046);const Ot=function(t){var e=String.fromCharCode,n=function(t){for(var n=[],o=0,i=t.length;o<i;o++)n.push(e(t[o]));return btoa(n.join(""))},o=function(t){return t.charCodeAt(0)},i=function(t){return Uint8Array.from(atob(t),o)};return t.decode=i,t.encode=n,t}({});async function Lt(t){let e;while(!e){const o=await Vt.utils.sha256(t),i=Vt.utils.bytesToHex(o),a="02"+i;try{e=Vt.Point.fromHex(a)}catch(n){t=await Vt.utils.sha256(t)}}return e}async function Qt(t){t=Ot.encode(t),t=(new TextEncoder).encode(t);const e=await Lt(t),n=Vt.utils.randomPrivateKey(),o=Zt(n),i=Vt.Point.fromPrivateKey(o),a=e.add(i);return{B_:a.toHex(!0),r:Vt.utils.bytesToHex(n)}}function $t(t,e,n){const o=Zt(e),i=t.subtract(n.multiply(o));return i}var Nt=n(2743);function jt(t,e=20,n=5){if(t.length>e+n)return t.substring(0,e)+"..."+t.substring(t.length-n,t.length)}const Kt={class:"row"},Ft={class:"col-12"},Jt={class:"q-my-none q-py-none"},Yt={key:0,class:"row q-mt-sm q-mb-none"},Gt={class:"col-12"},Xt={class:"q-my-none q-py-none text-weight-regular"},te={key:1,class:"row q-mt-xs q-mb-none"},ee={class:"col-12 cursor-pointer"},ne={key:0,class:"row q-mt-xs q-mb-none"},oe={class:"col-12"};function ie(t,e,n,a,s,r){const l=(0,o.up)("q-icon"),c=(0,o.up)("q-card-section"),u=(0,o.up)("q-card");return(0,o.wg)(),(0,o.j4)(u,{class:"q-my-md q-py-sm"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{class:"q-mt-sm q-py-xs"},{default:(0,o.w5)((()=>[(0,o._)("div",null,[(0,o._)("div",Kt,[(0,o._)("div",Ft,[(0,o._)("h3",Jt,[(0,o._)("strong",null,(0,i.zw)(t.formatSat(t.getTotalBalance)),1),(0,o.Uk)(" "+(0,i.zw)(t.tickerShort),1)])])]),t.mints.length>1?((0,o.wg)(),(0,o.iD)("div",Yt,[(0,o._)("div",Gt,[(0,o.Wm)(l,{name:"account_balance",size:"0.9rem",color:"grey",class:"q-mr-none q-mb-xs"}),(0,o._)("span",Xt,[(0,o.Uk)(" Active mint: "),(0,o._)("b",null,(0,i.zw)(t.formatSat(t.getBalance))+" "+(0,i.zw)(t.tickerShort),1)])])])):(0,o.kq)("",!0),t.activeMintUrl?((0,o.wg)(),(0,o.iD)("div",te,[(0,o._)("div",ee,[(0,o.Wm)(l,{name:"link",size:"1rem",color:"grey",class:"q-mr-none q-mb-none",onClick:e[0]||(e[0]=e=>t.setTab("settings"))}),(0,o._)("span",{class:"text-weight-light",onClick:e[1]||(e[1]=e=>t.setTab("settings"))},[(0,o.Uk)(" Mint: "),(0,o._)("b",null,(0,i.zw)(t.getActiveMintUrlShort),1)])])])):(0,o.kq)("",!0)]),t.pendingBalance>0?((0,o.wg)(),(0,o.iD)("div",ne,[(0,o._)("div",oe,[(0,o.Wm)(l,{name:"history",size:"1rem",color:"grey",class:"q-mr-none q-mb-xs cursor-pointer",onClick:e[2]||(e[2]=e=>t.checkPendingTokens())}),(0,o._)("span",{class:"text-weight-light cursor-pointer",onClick:e[3]||(e[3]=e=>t.setTab("history"))}," Pending: "+(0,i.zw)(t.formatSat(t.pendingBalance))+" "+(0,i.zw)(t.tickerShort),1)])])):(0,o.kq)("",!0)])),_:1})])),_:1})}function ae(t){t=t.replace("https://",""),t=t.replace("http://","");const e=46;return t.length>e&&-1!=t.indexOf("/")&&(t=t.substring(0,t.indexOf("/")+1)+"..."+t.substring(t.length-e/2,t.length)),t}const se=(0,o.aZ)({name:"BalanceView",mixins:[windowMixin],props:{proofs:Array,activeProofs:Array,mints:Array,tickerShort:String,activeMintUrl:String,pendingBalance:Number,checkPendingTokens:Function,setTab:Function},computed:{balance:function(){return this.activeProofs.flat().reduce(((t,e)=>t+e.amount),0)},allMintKeysets:function(){return[].concat(...this.mints.map((t=>t.keysets)))},getTotalBalance:function(){return this.proofs.filter((t=>this.allMintKeysets.includes(t.id))).flat().reduce(((t,e)=>t+e.amount),0)},getActiveMintUrlShort:function(){return ae(this.activeMintUrl)},getBalance:function(){var t=this.activeProofs.flat().reduce(((t,e)=>t+e.amount),0);return t}},methods:{}});var re=n(1639),le=n(4458),ce=n(3190),ue=n(2857),he=n(9984),de=n.n(he);const me=(0,re.Z)(se,[["render",ie]]),pe=me;de()(se,"components",{QCard:le.Z,QCardSection:ce.Z,QIcon:ue.Z});const fe={class:"q-py-md q-px-xs text-left","on-left":""},we={class:"q-gutter-md q-pt-md q-px-sm"},ye={class:"row-12"},ge={class:"q-py-sm q-px-xs text-left","on-left":""},ve=(0,o._)("h6",{class:"q-my-md text-primary"},"Do you trust this mint?",-1),ke=(0,o._)("p",null," A Cashu mint does not know about your financial activity but it controls your funds. Make sure that you trust the operator of this mint. ",-1),be={class:"row q-mt-lg"};function De(t,e,n,s,r,l){const c=(0,o.up)("q-item-label"),u=(0,o.up)("q-item-section"),h=(0,o.up)("q-item"),d=(0,o.up)("q-icon"),m=(0,o.up)("q-badge"),p=(0,o.up)("q-separator"),f=(0,o.up)("q-list"),w=(0,o.up)("q-btn"),y=(0,o.up)("q-input"),g=(0,o.up)("q-select"),v=(0,o.up)("q-card"),k=(0,o.up)("q-dialog"),b=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",fe,[(0,o.Wm)(f,{padding:""},{default:(0,o.w5)((()=>[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,{overline:""},{default:(0,o.w5)((()=>[(0,o.Uk)("Mints")])),_:1}),(0,o.Wm)(c,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("You can connect your wallet to multiple Cashu mints. Enter a mint URL and select the mint your want to use.")])),_:1})])),_:1})])),_:1}),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.mints,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.url},[(0,o.Wm)(h,{active:e.url==t.activeMintUrl,"active-class":"text-weight-bold text-primary"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{avatar:""},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{color:e.url==t.activeMintUrl?"primary":"grey",name:e.url==t.activeMintUrl?"check_circle":"radio_button_unchecked",onClick:n=>t.activateMint(e.url,t.verbose=!1),class:"cursor-pointer"},null,8,["color","name","onClick"])])),_:2},1024),(0,o.Wm)(u,{class:"q-mx-none q-pl-none",style:{"max-width":"1.05em"}},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{name:"content_copy",onClick:n=>t.copyText(e.url),size:"1em",color:"grey",class:"q-mr-xs cursor-pointer"},null,8,["onClick"])])),_:2},1024),(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,{lines:"1",onClick:n=>t.activateMint(e.url,t.verbose=!1)},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(e.url),1)])),_:2},1032,["onClick"]),e.url==t.activeMintUrl?((0,o.wg)(),(0,o.j4)(c,{key:0,caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("This is your active mint.")])),_:1})):(0,o.kq)("",!0)])),_:2},1024),(0,o.Wm)(u,{side:""},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{color:e.url==t.activeMintUrl?"primary":"grey",label:t.formatSat(e.balance)+" "+t.tickerShort},null,8,["color","label"])])),_:2},1024),(0,o.Wm)(u,{side:""},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{name:"close",onClick:n=>t.removeMint(e.url),class:"cursor-pointer"},null,8,["onClick"])])),_:2},1024)])),_:2},1032,["active"]),(0,o.Wm)(p,{spaced:"",inset:"item"})])))),128))])),_:1})]),(0,o._)("div",we,[(0,o._)("div",ye,[(0,o.Wm)(y,{standout:"","bottom-slots":"",onKeydown:(0,a.D2)((0,a.iM)(t.showAddMintDialog,["prevent"]),["enter"]),modelValue:t.mintToAdd,"onUpdate:modelValue":e[0]||(e[0]=e=>t.mintToAdd=e),label:"Add new mint URL"},{before:(0,o.w5)((()=>[(0,o.Wm)(d,{name:"account_balance"})])),append:(0,o.w5)((()=>[(0,o.Wm)(w,{round:"",dense:"",flat:"",color:"primary",icon:"add",click:"",onClick:t.showAddMintDialog},null,8,["onClick"])])),_:1},8,["onKeydown","modelValue"])])]),(0,o._)("div",ge,[(0,o.Wm)(f,{padding:""},{default:(0,o.w5)((()=>[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,{overline:""},{default:(0,o.w5)((()=>[(0,o.Uk)("Multimint Swaps")])),_:1}),(0,o.Wm)(c,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("Swap funds from one mint to another via Lightning. Note: Leave room for potential Lightning fees.")])),_:1})])),_:1})])),_:1}),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(g,{clearable:"",filled:"",dense:"",color:"primary",modelValue:t.swapData.from_url,"onUpdate:modelValue":e[1]||(e[1]=e=>t.swapData.from_url=e),options:t.swapDataOptions(),"option-value":"url","option-label":"shorturl",label:"Swap from",style:{"min-width":"200px"}},null,8,["modelValue","options"])])),_:1}),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(g,{clearable:"",filled:"",dense:"",color:"primary",modelValue:t.swapData.to_url,"onUpdate:modelValue":e[2]||(e[2]=e=>t.swapData.to_url=e),options:t.swapDataOptions(),"option-value":"url","option-label":"shorturl",label:"Swap to",style:{"min-width":"200px"}},null,8,["modelValue","options"])])),_:1}),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,{filled:"",dense:"",modelValue:t.swapData.amount,"onUpdate:modelValue":e[3]||(e[3]=e=>t.swapData.amount=e),modelModifiers:{number:!0},type:"number",label:"Amount ("+t.tickerShort+")",style:{"min-width":"200px"}},null,8,["modelValue","label"]),(0,o.Wm)(w,{class:"q-mx-md",color:"primary",onClick:e[4]||(e[4]=e=>t.mintSwap(t.swapData.from_url.url,t.swapData.to_url.url,t.swapData.amount)),disable:!t.swapData.from_url||!t.swapData.to_url||!(t.swapData.amount>0)},{default:(0,o.w5)((()=>[(0,o.Uk)("Swap")])),_:1},8,["disable"])])),_:1})])),_:1})]),(0,o.Wm)(k,{modelValue:t.addMintDialog.show,"onUpdate:modelValue":e[7]||(e[7]=e=>t.addMintDialog.show=e),onKeydown:e[8]||(e[8]=(0,a.D2)((0,a.iM)((e=>t.addMint(t.mintToAdd,t.verbose=!0)),["prevent"]),["enter"]))},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{class:"q-pa-lg"},{default:(0,o.w5)((()=>[ve,ke,(0,o.Wm)(y,{outlined:"",readonly:"",modelValue:t.mintToAdd,"onUpdate:modelValue":e[5]||(e[5]=e=>t.mintToAdd=e),label:"Mint URL",type:"textarea",autogrow:"",class:"q-mb-xs"},null,8,["modelValue"]),(0,o._)("div",be,[(0,o.wy)(((0,o.wg)(),(0,o.j4)(w,{outline:"",color:"primary",icon:"check",onClick:e[6]||(e[6]=e=>t.addMint(t.mintToAdd,t.verbose=!0))},{default:(0,o.w5)((()=>[(0,o.Uk)("Add mint")])),_:1})),[[b]]),(0,o.wy)(((0,o.wg)(),(0,o.j4)(w,{flat:"",color:"grey",class:"q-ml-auto"},{default:(0,o.w5)((()=>[(0,o.Uk)("Cancel")])),_:1})),[[b]])])])),_:1})])),_:1},8,["modelValue"])],64)}const Se=(0,o.aZ)({name:"SettingsView",mixins:[windowMixin],props:{proofs:Array,activeProofs:Array,mints:Array,tickerShort:String,activeMintUrl:String,addMint:Function,removeMint:Function,activateMint:Function,requestMint:Function,decodeRequest:Function,melt:Function,invoiceCheckWorker:Function,payInvoiceData:Object,showMintDialog:Boolean,mintToAddWalletPage:String},data:function(){return{swapData:{from_url:"",to_url:"",amount:0},addMintDialog:{show:!1},mintToAdd:"https://8333.space:3338"}},watch:{showMintDialog:function(){this.addMintDialog.show=this.showMintDialog},mintToAddWalletPage:function(){this.mintToAddWalletPage.length>0&&(this.mintToAdd=this.mintToAddWalletPage)}},methods:{swapDataOptions:function(){let t=[];for(const[e,n]of Object.entries(this.mints))t.push({url:n.url,shorturl:ae(n.url)});return t},showAddMintDialog:function(){this.addMintDialog.show=!0},mintSwap:async function(t,e,n){await this.activateMint(e);let o=await this.requestMint(n);await this.activateMint(t),await this.decodeRequest(o.pr),await this.melt(),await this.activateMint(e),await this.invoiceCheckWorker(),this.notifySuccess("Swap successful!")}},created:function(){}});var _e=n(3246),qe=n(490),xe=n(1233),Ie=n(3115),Te=n(990),Ue=n(926),We=n(6611),Me=n(8879),Pe=n(7887),Ae=n(2074),Ce=n(2146);const Ee=(0,re.Z)(Se,[["render",De]]),Be=Ee;de()(Se,"components",{QList:_e.Z,QItem:qe.Z,QItemSection:xe.Z,QItemLabel:Ie.Z,QIcon:ue.Z,QBadge:Te.Z,QSeparator:Ue.Z,QInput:We.Z,QBtn:Me.Z,QSelect:Pe.Z,QDialog:Ae.Z,QCard:le.Z}),de()(Se,"directives",{ClosePopup:Ce.Z});const Ve={key:0},Re={key:1},Ze=["onClick"],He=["onClick"];function ze(t,e,n,a,s,r){const l=(0,o.up)("q-tooltip"),c=(0,o.up)("q-icon"),u=(0,o.up)("q-td"),h=(0,o.up)("q-tr"),d=(0,o.up)("q-table");return(0,o.wg)(),(0,o.j4)(d,{dense:"",flat:"",rows:t.invoiceHistory,columns:t.invoicesTable.columns,"no-data-label":"There are no invoices here yet",filter:t.invoicesTable.filter,pagination:t.invoicesTable.pagination},{body:(0,o.w5)((e=>[(0,o.Wm)(h,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{key:"status",props:e},{default:(0,o.w5)((()=>["pending"==e.row.status?((0,o.wg)(),(0,o.iD)("div",Ve,[(0,o.Wm)(c,{onClick:n=>t.showInvoiceInfoDialog(e.row),name:"settings_ethernet",color:"grey"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Pending")])),_:1})])),_:2},1032,["onClick"]),(0,o.Wm)(c,{name:"sync",size:"xs",color:"grey",class:"q-mr-xs cursor-pointer",onClick:n=>t.checkInvoice(e.row.hash,!0)},{default:(0,o.w5)((()=>[(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Check status")])),_:1})])),_:2},1032,["onClick"])])):(0,o.kq)("",!0),"paid"===e.row.status?((0,o.wg)(),(0,o.iD)("div",Re,[e.row.amount>0?((0,o.wg)(),(0,o.j4)(c,{key:0,name:"call_received",color:"green"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Received")])),_:1})])),_:1})):(0,o.kq)("",!0),e.row.amount<0?((0,o.wg)(),(0,o.j4)(c,{key:1,name:"call_made",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Paid")])),_:1})])),_:1})):(0,o.kq)("",!0)])):(0,o.kq)("",!0)])),_:2},1032,["props"]),(0,o.Wm)(u,{key:"amount",props:e,class:(0,i.C_)(e.row.amount>0&&"paid"===e.row.status?"text-green-13 text-weight-bold":"")},{default:(0,o.w5)((()=>[(0,o._)("div",null,(0,i.zw)(t.formatSat(e.row.amount)),1)])),_:2},1032,["props","class"]),(0,o.Wm)(u,{key:"date",props:e},{default:(0,o.w5)((()=>[(0,o._)("div",null,(0,i.zw)(e.row.date),1)])),_:2},1032,["props"]),(0,o.Wm)(u,{key:"bolt11",props:e},{default:(0,o.w5)((()=>[(0,o._)("div",{onClick:n=>t.copyText(e.row.bolt11)},[(0,o.Uk)((0,i.zw)(t.shortenString(e.row.bolt11))+" ",1),(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Click to copy")])),_:1})],8,Ze)])),_:2},1032,["props"]),(0,o.Wm)(u,{key:"hash",props:e},{default:(0,o.w5)((()=>[(0,o._)("div",{onClick:n=>t.copyText(e.row.hash)},(0,i.zw)(e.row.hash),9,He)])),_:2},1032,["props"]),(0,o.Wm)(u,{key:"mint",props:e},{default:(0,o.w5)((()=>[(0,o._)("div",null,(0,i.zw)(e.row.mint),1)])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:1},8,["rows","columns","filter","pagination"])}const Oe=(0,o.aZ)({name:"InvoicesTable",mixins:[windowMixin],props:{proofs:Array,activeProofs:Array,mints:Array,tickerShort:String,activeMintUrl:String,invoiceHistory:Array,showInvoiceInfoDialog:Function,checkInvoice:Function},data:function(){return{invoicesTable:{columns:[{name:"status",align:"left",label:"",field:"status",sortable:!0},{name:"amount",align:"left",label:"Amount",field:"amount",sortable:!0},{name:"date",align:"left",label:"Date",field:"date",sortable:!0},{name:"bolt11",align:"left",label:"Payment request",field:"bolt11",sortable:!1},{name:"hash",align:"left",label:"Hash",field:"hash",sortable:!1},{name:"mint",align:"left",label:"Mint",field:"mint",sortable:!0}],pagination:{sortBy:"date",descending:!0,rowsPerPage:5},filter:null}}},methods:{shortenString:function(t){return jt(t,20,10)}},created:function(){}});var Le=n(9405),Qe=n(3532),$e=n(7220),Ne=n(6858);const je=(0,re.Z)(Oe,[["render",ze]]),Ke=je;de()(Oe,"components",{QTable:Le.Z,QTr:Qe.Z,QTd:$e.Z,QIcon:ue.Z,QTooltip:Ne.Z});const Fe={key:0},Je={key:1},Ye=["onClick"];function Ge(t,e,n,a,s,r){const l=(0,o.up)("q-tooltip"),c=(0,o.up)("q-icon"),u=(0,o.up)("q-td"),h=(0,o.up)("q-tr"),d=(0,o.up)("q-table");return(0,o.wg)(),(0,o.j4)(d,{dense:"",flat:"",rows:t.historyTokens,columns:t.historyTable.columns,"no-data-label":"There are no tokens here yet",filter:t.historyTable.filter,pagination:t.historyTable.pagination},{body:(0,o.w5)((e=>[(0,o.Wm)(h,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{key:"status",props:e},{default:(0,o.w5)((()=>["pending"==e.row.status?((0,o.wg)(),(0,o.iD)("div",Fe,[(0,o.Wm)(c,{onClick:n=>t.showTokenDialog(e.row.token),name:"settings_ethernet",color:"grey"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Pending")])),_:1})])),_:2},1032,["onClick"]),(0,o.Wm)(c,{name:"sync",size:"xs",color:"grey",class:"q-mr-xs cursor-pointer",onClick:n=>t.checkTokenSpendable(e.row.token)},{default:(0,o.w5)((()=>[(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Check status")])),_:1})])),_:2},1032,["onClick"])])):(0,o.kq)("",!0),"paid"===e.row.status?((0,o.wg)(),(0,o.iD)("div",Je,[e.row.amount>0?((0,o.wg)(),(0,o.j4)(c,{key:0,name:"call_received",color:"green"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Received")])),_:1})])),_:1})):(0,o.kq)("",!0),e.row.amount<0?((0,o.wg)(),(0,o.j4)(c,{key:1,name:"call_made",color:"red"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Paid")])),_:1})])),_:1})):(0,o.kq)("",!0)])):(0,o.kq)("",!0)])),_:2},1032,["props"]),(0,o.Wm)(u,{key:"amount",props:e,class:(0,i.C_)(e.row.amount>0?"text-green-13 text-weight-bold":"")},{default:(0,o.w5)((()=>[(0,o._)("div",null,(0,i.zw)(t.formatSat(e.row.amount)),1)])),_:2},1032,["props","class"]),(0,o.Wm)(u,{key:"date",props:e},{default:(0,o.w5)((()=>[(0,o._)("div",null,(0,i.zw)(e.row.date),1)])),_:2},1032,["props"]),(0,o.Wm)(u,{key:"token",props:e},{default:(0,o.w5)((()=>[(0,o._)("div",{onClick:n=>t.copyText(e.row.token)},[(0,o.Uk)((0,i.zw)(t.shortenString(e.row.token,10,40))+" ",1),(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Click to copy")])),_:1})],8,Ye)])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:1},8,["rows","columns","filter","pagination"])}const Xe=(0,o.aZ)({name:"HistoryTable",mixins:[windowMixin],props:{proofs:Array,activeProofs:Array,mints:Array,tickerShort:String,activeMintUrl:String,historyTokens:Array,showTokenDialog:Function,checkTokenSpendable:Function},data:function(){return{historyTable:{columns:[{name:"status",align:"left",label:"",field:"status",sortable:!0},{name:"amount",align:"left",label:"Amount",field:"amount",sortable:!0},{name:"date",align:"left",label:"Date",field:"date",sortable:!0},{name:"token",align:"left",label:"Token",field:"token",sortable:!1}],pagination:{sortBy:"date",descending:!0,rowsPerPage:5},filter:null}}},methods:{shortenString:function(t){return jt(t,20,10)}},created:function(){}}),tn=(0,re.Z)(Xe,[["render",Ge]]),en=tn;de()(Xe,"components",{QTable:Le.Z,QTr:Qe.Z,QTd:$e.Z,QIcon:ue.Z,QTooltip:Ne.Z});const nn={class:"text-overline"},on=(0,o._)("div",{class:"text-h6"},"You're not connected to any mint yet",-1),an=(0,o._)("div",{class:"text-subtitle2"}," Go to the Settings tab to add a mint bewore using this wallet ",-1);function sn(t,e,n,i,a,s){const r=(0,o.up)("q-badge"),l=(0,o.up)("q-separator"),c=(0,o.up)("q-card-section"),u=(0,o.up)("q-card");return(0,o.wg)(),(0,o.j4)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o._)("div",nn,[(0,o.Wm)(r,{color:"primary",label:"Warning"})]),(0,o.Wm)(l,{class:"q-mb-sm"}),on,an])),_:1})])),_:1})}const rn=(0,o.aZ)({name:"NoMintWarnBanner",mixins:[windowMixin],props:{proofs:Array,activeProofs:Array,mints:Array,tickerShort:String,activeMintUrl:String},computed:{balance:function(){return this.activeProofs.map((t=>t)).flat().reduce(((t,e)=>t+e.amount),0)},getTotalBalance:function(){return this.proofs.map((t=>t)).flat().reduce(((t,e)=>t+e.amount),0)},getActiveMintUrlShort:function(){return ae(this.activeMintUrl)},getBalance:function(){var t=this.activeProofs.map((t=>t)).flat().reduce(((t,e)=>t+e.amount),0);return t}},methods:{}}),ln=(0,re.Z)(rn,[["render",sn]]),cn=ln;de()(rn,"components",{QCard:le.Z,QCardSection:ce.Z,QBadge:Te.Z,QSeparator:Ue.Z});const un={class:"q-pb-md"},hn={key:0,class:"row q-mt-xs q-mb-none"},dn={class:"col-12 cursor-pointer"};function mn(t,e,n,i,a,s){const r=(0,o.up)("q-icon"),l=(0,o.up)("q-badge"),c=(0,o.up)("q-select");return(0,o.wg)(),(0,o.iD)("div",un,[t.activeMintUrl?((0,o.wg)(),(0,o.iD)("div",hn,[(0,o._)("div",dn,[(0,o.Wm)(c,{borderless:"",dense:"",color:"primary",modelValue:t.chosenMint,"onUpdate:modelValue":e[0]||(e[0]=e=>t.chosenMint=e),options:t.chooseMintOptions(),"option-value":"url","option-label":"shorturl"},{prepend:(0,o.w5)((()=>[(0,o.Wm)(r,{name:"account_balance",size:"1.2rem",color:"grey",class:"q-mr-none q-mb-none"})])),append:(0,o.w5)((()=>[(0,o.Wm)(l,{color:"primary",label:t.formatSat(t.getBalance)+" "+t.tickerShort},null,8,["label"])])),_:1},8,["modelValue","options"])])])):(0,o.kq)("",!0)])}const pn=(0,o.aZ)({name:"ChooseMint",mixins:[windowMixin],props:{proofs:Array,activeProofs:Array,mints:Array,tickerShort:String,activeMintUrl:String,activateMint:Function},data:function(){return{chosenMint:ae(this.activeMintUrl)}},watch:{chosenMint:async function(){console.log("Mint chosen ",this.chosenMint),await this.activateMint(this.chosenMint.url)}},computed:{balance:function(){return this.activeProofs.flat().reduce(((t,e)=>t+e.amount),0)},allMintKeysets:function(){return[].concat(...this.mints.map((t=>t.keysets)))},getTotalBalance:function(){return this.proofs.filter((t=>this.allMintKeysets.includes(t.id))).flat().reduce(((t,e)=>t+e.amount),0)},getActiveMintUrlShort:function(){return ae(this.activeMintUrl)},getBalance:function(){var t=this.activeProofs.flat().reduce(((t,e)=>t+e.amount),0);return t}},methods:{chooseMintOptions:function(){let t=[];for(const[e,n]of Object.entries(this.mints))t.push({url:n.url,shorturl:ae(n.url)});return t}}}),fn=(0,re.Z)(pn,[["render",mn]]),wn=fn;de()(pn,"components",{QSelect:Pe.Z,QIcon:ue.Z,QBadge:Te.Z});const yn={class:"row text-left q-py-none q-my-none"},gn={class:"col-12 q-px-sm"},vn={class:"q-mr-md"},kn=(0,o._)("span",null,"Mint: ",-1),bn={key:0},Dn={key:1};function Sn(t,e,n,a,s,r){const l=(0,o.up)("q-icon");return(0,o.wg)(),(0,o.iD)("div",yn,[(0,o._)("div",gn,[(0,o.Wm)(l,{name:"toll",size:"xs",color:"grey",class:"q-mr-xs"}),(0,o._)("span",vn,[(0,o._)("strong",null,(0,i.zw)(t.formatSat(t.sumProofs))+" "+(0,i.zw)(t.tickerShort),1)]),(0,o.Wm)(l,{name:"account_balance",size:"xs",color:"grey",class:"q-mr-xs"}),kn,t.mintKnownToUs(t.proofsToShow)?((0,o.wg)(),(0,o.iD)("span",bn,[(0,o.Uk)((0,i.zw)(t.getProofsMint(t.proofsToShow))+" ",1),(0,o.Wm)(l,{name:"check",size:"xs",color:"green",class:"q-mr-xs"})])):((0,o.wg)(),(0,o.iD)("span",Dn,(0,i.zw)(t.tokenMintUrl),1))])])}const _n=(0,o.aZ)({name:"TokenInformation",mixins:[windowMixin],props:{proofs:Array,activeProofs:Array,mints:Array,tickerShort:String,activeMintUrl:String,proofsToShow:Array,tokenMintUrl:String},data:function(){return{}},watch:{},computed:{sumProofs:function(){return this.proofsToShow.flat().reduce(((t,e)=>t+e.amount),0)}},methods:{getProofsMint:function(t){let e=[...new Set(t.map((t=>t.id)))],n=this.mints.filter((t=>t.keysets.some((t=>e.indexOf(t)>=0)))),o=n.map((t=>[{url:t.url,ids:t.keysets}][0]));return 0==o.length?"":ae(o[0].url)},mintKnownToUs:function(t){let e=[...new Set(t.map((t=>t.id)))];return this.mints.filter((t=>t.keysets.some((t=>e.indexOf(t)>=0)))).length>0}}}),qn=(0,re.Z)(_n,[["render",Sn]]),xn=qn;de()(_n,"components",{QIcon:ue.Z});var In=function(){return Bt.ZP.formatDate(new Date,"YYYY-MM-DD HH:mm:ss")};const Tn={mixins:[windowMixin],components:{BalanceView:pe,SettingsView:Be,InvoicesTable:Ke,HistoryTable:en,NoMintWarnBanner:cn,ChooseMint:wn,TokenInformation:xn},data:function(){return{tickerShort:"sats",ticketLong:"Satoshis",name:"",mintId:"",mintName:"",activeMintUrl:"",mints:[],keys:"",proofs:[],activeProofs:[],deferredPWAInstallPrompt:null,invoiceHistory:[],historyTokens:[],invoiceData:{amount:0,memo:"",bolt11:"",hash:""},camera:{data:null,show:!1,camera:"auto"},invoiceCheckListener:()=>{},payInvoiceData:{blocking:!1,bolt11:"",show:!1,invoice:null,lnurlpay:null,lnurlauth:null,data:{request:"",amount:0,comment:""},paymentChecker:null,camera:{show:!1,camera:"auto"}},sendData:{amount:0,memo:"",tokens:"",tokensBase64:""},receiveData:{tokensBase64:""},showInvoiceDetails:!1,showPayInvoice:!1,showSendTokens:!1,showSendTokenLegacyV2Token:!1,showSendTokenLegacyV2TokenToggleState:(0,At.iH)(!1),showReceiveTokens:!1,promises:[],tokens:[],tab:"history",receive:{show:!1,status:"pending",paymentReq:null,paymentHash:null,minMax:[0,21e14],lnurl:null,units:["sat"],unit:"sat",data:{amount:null,memo:""}},parse:{show:!1,invoice:null,lnurlpay:null,lnurlauth:null,data:{request:"",amount:0,comment:""},paymentChecker:null,camera:{show:!1,camera:"auto"}},payments:[],paymentsChart:{show:!1},welcomeDialog:{show:!1},disclaimerDialog:{show:!1,location:window.location,base_url:location.protocol+"//"+location.host+location.pathname},addMintDialog:{show:!1,mintToAdd:""},baseHost:location.protocol+"//"+location.host,baseURL:location.protocol+"//"+location.host+location.pathname,credit:0,newName:""}},computed:{canPay:function(){return!!this.payInvoiceData.invoice&&this.payInvoiceData.invoice.sat<=this.balance},pendingPaymentsExist:function(){return-1!==this.payments.findIndex((t=>t.pending))},balance:function(){return this.activeProofs.map((t=>t)).flat().reduce(((t,e)=>t+e.amount),0)},pendingBalance:function(){return-this.historyTokens.filter((t=>"pending"==t.status)).reduce(((t,e)=>t+e.amount),0)}},filters:{msatoshiFormat:function(t){return LNbits.utils.formatSat(t/1e3)}},methods:{decodeToken:function(t){try{let e=["web+cashu://","cashu:","cashu://"];if(e.forEach((e=>{t.startsWith(e)&&(t=t.slice(e.length))})),t.startsWith("eyJwcm9")){let e=JSON.parse(atob(t)),n={token:[{proofs:e.proofs,mint:e.mints[0].url}]};return n}let n="cashuA";if(t.startsWith(n)){let e=t.slice(n.length),o=JSON.parse(atob(e));if(!(o.token.length>0)||!(o.token[0].proofs.length>0))throw new Error("No proofs in encoded token");return o}}catch(e){return""}},getProofs:function(t){if(!(t.token.length>0)||!(t.token[0].proofs.length>0))throw new Error("Token format wrong");return t.token.map((t=>t.proofs)).flat()},getMint:function(t){return null!=t.token&&t.token.length>0?t.token[0].mint:""},addMint:async function(t,e=!1){try{0==this.mints.length?this.mints=[{url:t,balance:0}]:0==this.mints.filter((e=>e.url==t)).length&&this.mints.push({url:t,balance:0}),localStorage.setItem("cashu.mints",JSON.stringify(this.mints)),await this.activateMint(t,e)}catch(n){throw n}finally{this.addMintDialog.show=!1}},activateMint:async function(t,e=!1){if(t==this.activeMintUrl)return;this.clearAllWorkers();let n=this.activeMintUrl,o=this.keys,i=this.keysets;try{if(this.activeMintUrl=t,console.log("### this.activeMintUrl",this.activeMintUrl),await this.fetchMintKeys(),this.activeProofs=this.proofs.filter((t=>this.keysets.includes(t.id))),e&&this.notifySuccess("Mint added."),this.mints.length>0&&this.activeMintUrl){let t=this.mints.filter((t=>t.url==this.activeMintUrl));t.length>0&&(t[0].balance=this.getBalance())}localStorage.setItem("cashu.activeMintUrl",this.activeMintUrl),console.log("### activateMint: Mint activated: ",this.activeMintUrl,"balanbce",this.getBalance())}catch(a){this.activeMintUrl=n,this.keys=o,this.keysets=i;let t="Could not connect to mint.";a.message.length&&(t+=` ${a.message}.`),this.notifyError(t,"Mint activation")}},removeMint:async function(t){this.mints=this.mints.filter((e=>e.url!=t)),localStorage.setItem("cashu.mints",JSON.stringify(this.mints)),t==this.activeMintUrl&&(this.activeMintUrl="",localStorage.setItem("cashu.activeMintUrl",this.activeMintUrl)),this.mints.length>0&&await this.activateMint(this.mints[0].url),this.notifySuccess("Mint removed.")},getBalance:function(){var t=this.activeProofs.map((t=>t)).flat().reduce(((t,e)=>t+e.amount),0);return t},shortenString:function(t){return jt(t,20,10)},getTokenList:function(){const t=this.activeProofs.map((t=>t.amount)),e={};for(const n of t)e[n]=e[n]?e[n]+1:1;return Object.keys(e).map((t=>({value:parseInt(t),count:parseInt(e[t]),sum:t*e[t]})))},paymentTableRowKey:function(t){return t.payment_hash+t.amount},closeCamera:function(){this.camera.show=!1},showCamera:function(){this.camera.show=!0},hasCamera:function(){navigator.permissions.query({name:"camera"}).then((t=>"granted"==t.state))},showChart:function(){this.paymentsChart.show=!0,this.$nextTick((()=>{generateChart(this.$refs.canvas,this.payments)}))},focusInput(t){this.$nextTick((()=>this.$refs[t].focus()))},showReceiveDialog:function(){this.receive.show=!0,this.receive.status="pending",this.receive.paymentReq=null,this.receive.paymentHash=null,this.receive.data.amount=null,this.receive.data.memo=null,this.receive.unit="sat",this.receive.paymentChecker=null,this.receive.minMax=[0,21e14],this.receive.lnurl=null,this.focusInput("setAmount")},showParseDialog:function(){this.payInvoiceData.show=!0,this.payInvoiceData.invoice=null,this.payInvoiceData.lnurlpay=null,this.payInvoiceData.domain="",this.payInvoiceData.lnurlauth=null,this.payInvoiceData.data.request="",this.payInvoiceData.data.comment="",this.payInvoiceData.data.paymentChecker=null,this.camera.show=!1,this.focusInput("pasteInput")},showWelcomeDialog:function(){"seen"!=localStorage.getItem("cashu.welcomeDialogSeen")&&(this.welcomeDialog.show=!0)},setWelcomeDialogSeen:function(){localStorage.setItem("cashu.welcomeDialogSeen","seen"),this.setTab("settings")},setTab:function(t){this.tab=t},showDisclaimerDialog:function(){this.disclaimerDialog.show=!0},closeReceiveDialog:function(){setTimeout((()=>{clearInterval(this.receive.paymentChecker)}),1e4)},closeParseDialog:function(){setTimeout((()=>{clearInterval(this.payInvoiceData.paymentChecker)}),1e4)},decodeQR:function(t){this.camera.data=t,this.decodeRequest(),this.camera.show=!1},decodeRequest:function(t=null){"string"==typeof t&&null!=t&&(this.payInvoiceData.data.request=t);let e=null,o=null;if(this.camera.data?o=this.camera.data:this.payInvoiceData.data.request&&(o=this.payInvoiceData.data.request),o.toLowerCase().startsWith("lnbc")?(this.payInvoiceData.data.request=o,e="bolt11"):o.toLowerCase().startsWith("lightning:")?(this.payInvoiceData.data.request=o.slice(10),e="bolt11"):o.toLowerCase().startsWith("lnurl:")?(this.payInvoiceData.data.request=o.slice(6),e="lnurl"):-1!==o.indexOf("lightning=lnurl1")?(this.payInvoiceData.data.request=o.split("lightning=")[1].split("&")[0],e="lnurl"):o.toLowerCase().startsWith("lnurl1")||o.match(/[\w.+-~_]+@[\w.+-~_]/)?(this.payInvoiceData.data.request=o,e="lnurl"):o.indexOf("eyJwcm")&&(this.receiveData.tokensBase64=o.slice(o.indexOf("eyJwcm")),e="cashu"),"bolt11"==e){let t;console.log("#### QR CODE: BOLT11"),this.payInvoiceData.show=!0;try{t=n(8621).decode(this.payInvoiceData.data.request)}catch(i){throw this.notifyWarning("Failed to decode invoice",null,3e3),this.payInvoiceData.show=!1,i}let e={};Nt.S6(t.sections,(t=>{if(Nt.Kn(t)&&Nt.e$(t,"name"))if("amount"===t.name)e.msat=t.value,e.sat=t.value/1e3,e.fsat=e.sat;else if("payment_hash"===t.name)e.hash=t.value;else if("description"===t.name)e.description=t.value;else if("timestamp"===t.name)e.timestamp=t.value;else if("expiry"===t.name){var n=new Date(1e3*(e.timestamp+t.value));e.expireDate=Bt.ZP.formatDate(n,"YYYY-MM-DDTHH:mm:ss.SSSZ"),e.expired=!1}})),this.payInvoiceData.invoice=Object.freeze(e)}else"lnurl"==e?(console.log("#### QR CODE: LNURL"),this.lnurlPayFirst(this.payInvoiceData.data.request)):"cashu"==e&&(console.log("#### QR CODE: CASHU TOKEN"),this.payInvoiceData.show=!1,this.showReceiveTokens=!0)},lnurlPayFirst:async function(t){var e;if(2==t.split("@").length){let[n,o]=t.split("@");e=`https://${o}/.well-known/lnurlp/${n}`}else if("lnurl1"===t.toLowerCase().slice(0,6)){let e=Buffer.from(bech32.fromWords(bech32.decode(t,2e4).words)).toString();var{data:n}=await Et.Z.get(e);e=n.domain}var{data:n}=await Et.Z.get(e);"payRequest"==n.tag&&(this.payInvoiceData.domain=e.split("https://")[1].split("/")[0],this.payInvoiceData.lnurlpay=n,this.payInvoiceData.lnurlpay.maxSendable==this.payInvoiceData.lnurlpay.minSendable&&(this.payInvoiceData.data.amount=this.payInvoiceData.lnurlpay.maxSendable/1e3),this.payInvoiceData.show=!0)},lnurlPaySecond:async function(){let t=this.payInvoiceData.data.amount;if("payRequest"==this.payInvoiceData.lnurlpay.tag&&this.payInvoiceData.lnurlpay.minSendable<=1e3*t<=this.payInvoiceData.lnurlpay.maxSendable){var{data:e}=await Et.Z.get(`${this.payInvoiceData.lnurlpay.callback}?amount=${1e3*t}`);console.log(e.pr),this.payInvoiceData.data.request=e.pr,this.decodeRequest()}},payInvoice:function(){this.$q.notify({timeout:0,message:"Processing payment...",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})},showInvoiceCreateDialog:async function(){console.log("##### showInvoiceCreateDialog"),this.invoiceData.amount="",this.invoiceData.bolt11="",this.invoiceData.hash="",this.invoiceData.memo="",this.showInvoiceDetails=!0},showInvoicInfoDialog:function(t){console.log("##### showInvoicInfoDialog"),this.invoiceData=Nt.d9(t),this.showInvoiceDetails=!0,this.invoiceCheckWorker()},showTokenDialog:function(t){console.log("##### showTokenDialog"),this.sendData.tokens=this.getProofs(this.decodeToken(t)),this.sendData.tokensBase64=Nt.d9(t),this.showSendTokens=!0,this.checkTokenSpendableWorker()},sendTokenDialogSwitchTokenV3ToLegacyV2:function(){this.sendData.tokens.length>0&&(this.showSendTokenLegacyV2Token?(this.sendData.tokensBase64=this.serializeProofs(this.sendData.tokens),this.showSendTokenLegacyV2Token=!1):(this.sendData.tokensBase64=this.serializeProofsV2(this.sendData.tokens),this.showSendTokenLegacyV2Token=!0))},showSendTokensDialog:function(){console.log("##### showSendTokensDialog"),this.sendData.tokens="",this.sendData.tokensBase64="",this.sendData.amount="",this.sendData.memo="",this.showSendTokens=!0},showReceiveTokensDialog:function(){this.receiveData.tokensBase64="",this.showReceiveTokens=!0},generateSecrets:async function(t){const e=[];for(let n=0;n<t.length;n++){const t=Vt.utils.randomBytes(32);e.push(t)}return e},constructOutputs:async function(t,e){const n=[],o=[];for(let i=0;i<t.length;i++){const{B_:a,r:s}=await Qt(e[i]);n.push({amount:t[i],B_:a}),o.push(s)}return{outputs:n,rs:o}},constructProofs:function(t,e,n,o){const i=[];for(let a=0;a<t.length;a++){const s=Ot.encode(e[a]);let{id:r,amount:l,C:c,secret:u}=this.promiseToProof(t[a].id,t[a].amount,t[a]["C_"],s,n[a],o);i.push({id:r,amount:l,C:c,secret:u})}return i},promiseToProof:function(t,e,n,o,i,a){const s=Vt.Point.fromHex(n),r=a[e],l=$t(s,Vt.utils.hexToBytes(i),Vt.Point.fromHex(r));return{id:t,amount:e,C:l.toHex(!0),secret:o}},sumProofs:function(t){return t.reduce(((t,e)=>t+e.amount),0)},deleteProofs:function(t){const e=t.map((t=>t.secret));return this.proofs=this.proofs.filter((t=>!e.includes(t.secret))),this.storeProofs(),this.proofs},serializeProofs:function(t){let e=[...new Set(t.map((t=>t.id)))],n=this.mints.filter((t=>t.keysets.some((t=>e.indexOf(t)>=0)))),o=n.map((t=>[{url:t.url,ids:t.keysets}][0])),i={token:[{proofs:t,mint:o[0].url}]};return"cashuA"+btoa(JSON.stringify(i))},getProofsMint:function(t){let e=[...new Set(t.map((t=>t.id)))],n=this.mints.filter((t=>t.keysets.some((t=>e.indexOf(t)>=0)))),o=n.map((t=>[{url:t.url,ids:t.keysets}][0]));return o[0]},serializeProofsV2:function(t){let e=[...new Set(t.map((t=>t.id)))],n=this.mints.filter((t=>t.keysets.some((t=>e.indexOf(t)>=0)))),o=n.map((t=>[{url:t.url,ids:t.keysets}][0]));var i={proofs:t,mints:o};return btoa(JSON.stringify(i))},requestMintButton:async function(){await this.requestMint(),console.log("#### request mint",this.invoiceData),await this.invoiceCheckWorker()},requestMint:async function(t=null){null!=t&&(this.invoiceData.amount=t);try{const{data:t}=await Et.Z.get(`${this.activeMintUrl}/mint?amount=${this.invoiceData.amount}`);return this.assertMintError(t),console.log("### data",t),this.invoiceData.bolt11=t.pr,this.invoiceData.hash=t.hash,this.invoiceHistory.push(Object.assign({},this.invoiceData,{date:In(),status:"pending",mint:this.activeMintUrl})),this.storeInvoiceHistory(),t}catch(e){console.error(e);try{this.notifyApiError(e)}catch{}throw e}},mintApi:async function(t,e,n=!0){try{let n=await this.generateSecrets(t),{outputs:o,rs:i}=await this.constructOutputs(t,n);const a=this.keys,s=await Et.Z.post(`${this.activeMintUrl}/mint?payment_hash=${e}`,{outputs:o});if(this.assertMintError(s.data,!1),null==s.data.promises)return{};let r=await this.constructProofs(s.data.promises,n,i,a);return r}catch(o){if(console.error(o),n)try{this.notifyApiError(o)}catch{}throw o}},mint:async function(t,e,n=!0){try{const o=Rt(t),i=await this.mintApi(o,e,n);if(!i.length)throw"could not mint";return this.proofs=this.proofs.concat(i),this.activeProofs=this.activeProofs.concat([]),this.storeProofs(),await this.setInvoicePaid(e),this.historyTokens.push({status:"paid",amount:t,date:In(),token:this.serializeProofs(i)}),this.storehistoryTokens(),i}catch(o){if(console.error(o),n)try{this.notifyApiError(o)}catch{}throw o}},split:async function(t,e){try{if(0==t.length)throw new Error("no proofs provided.");let{fristProofs:n,scndProofs:o}=await this.splitApi(t,e);return this.deleteProofs(t),this.proofs=this.proofs.concat(n).concat(o),this.storeProofs(),{fristProofs:n,scndProofs:o}}catch(n){console.error(n);try{try{this.notifyApiError(n)}catch{}}catch{}throw n}},splitApi:async function(t,e){try{const n=this.sumProofs(t),o=n-e,i=e,a=Rt(o),s=Rt(i),r=Nt.d9(a);r.push(...s);let l=await this.generateSecrets(r);if(l.length!=r.length)throw new Error("number of secrets does not match number of outputs.");let{outputs:c,rs:u}=await this.constructOutputs(r,l);const h={amount:e,proofs:t,outputs:c},d=this.keys,{data:m}=await Et.Z.post(`${this.activeMintUrl}/split`,h);this.assertMintError(m);const p=u.slice(0,a.length),f=l.slice(0,a.length),w=u.slice(a.length),y=l.slice(a.length),g=this.constructProofs(m.fst,f,p,d),v=this.constructProofs(m.snd,y,w,d);return{fristProofs:g,scndProofs:v}}catch(n){this.payInvoiceData.blocking=!1,console.error(n);try{this.notifyApiError(n)}catch{}throw n}},splitToSend:async function(t,e,n=!1){try{const o=t.filter((t=>!t.reserved));if(this.sumProofs(o)<e)throw this.notifyWarning("Balance is too low.",`Your balance is ${this.getBalance()} sat and you're trying to pay ${e} sats.`),Error("balance too low.");let{fristProofs:i,scndProofs:a}=await this.split(o,e);const s=t.map((t=>t.secret));for(let t=0;t<this.proofs.length;t++)s.includes(this.proofs[t].secret)&&(this.proofs[t].reserved=!0);return this.proofs=this.proofs.concat([]),n&&this.deleteProofs(a),{fristProofs:i,scndProofs:a}}catch(o){console.error(o);try{this.notifyApiError(o)}catch{}throw o}},redeem:async function(){this.showReceiveTokens=!1,console.log("### receive tokens",this.receiveData.tokensBase64);try{if(0==this.receiveData.tokensBase64.length)throw new Error("no tokens provided.");const e=this.decodeToken(this.receiveData.tokensBase64);let n=this.getProofs(e);for(var t=0;t<e.token.length;t++){if(!this.mints.map((t=>t.url)).includes(this.getMint(e)))return await this.setTab("settings"),this.addMintDialog.mintToAdd=e.token[t].mint,this.addMintDialog.show=!0,void(this.showReceiveTokens=!0);this.getMint(e)!=this.activeMintUrl&&await this.activateMint(this.getMint(e))}const o=n.reduce(((t,e)=>t+e.amount),0);await this.split(n,o),this.proofs=this.proofs.concat([]),this.activeProofs=this.activeProofs.concat([]),this.getBalance(),this.historyTokens.push({status:"paid",amount:o,date:In(),token:this.receiveData.tokensBase64}),this.storehistoryTokens(),window.navigator.vibrate&&navigator.vibrate(200),this.notifySuccess("Tokens received.")}catch(e){console.error(e);try{this.notifyApiError(e)}catch{}throw e}},sendTokens:async function(){try{let{fristProofs:t,scndProofs:e}=await this.splitToSend(this.activeProofs,this.sendData.amount,!0);this.sendData.tokens=e,console.log("### this.sendData.tokens",this.sendData.tokens),this.sendData.tokensBase64=this.serializeProofs(e),this.historyTokens.push({status:"pending",amount:-this.sendData.amount,date:In(),token:this.sendData.tokensBase64}),this.storehistoryTokens(),this.checkTokenSpendableWorker()}catch(t){console.error(t)}},melt:async function(){this.payInvoiceData.blocking=!0,console.log("#### pay lightning");const t=this.payInvoiceData.invoice.sat,e=t+await this.checkFees(this.payInvoiceData.data.request);console.log("#### amount invoice",t,"amount with fees",e);let{fristProofs:n,scndProofs:o}=await this.splitToSend(this.activeProofs,e);try{let t=[1,1,1,1],n=await this.generateSecrets(t),{outputs:i,rs:a}=await this.constructOutputs(t,n),s=e;const r={proofs:o.flat(),amount:e,pr:this.payInvoiceData.data.request,outputs:i},l=this.keys,{data:c}=await Et.Z.post(`${this.activeMintUrl}/melt`,r);if(this.assertMintError(c),1!=c.paid)throw new Error("Invoice not paid.");if(window.navigator.vibrate&&navigator.vibrate(200),this.notifySuccess("Token paid."),console.log("#### pay lightning: token paid"),this.deleteProofs(o),null!=c.change){const t=this.constructProofs(c.change,n,a,l);console.log("## Received change: "+this.sumProofs(t)),s-=this.sumProofs(t),this.proofs=this.proofs.concat(t),this.activeProofs=this.activeProofs.concat([]),this.storeProofs()}this.historyTokens.push({status:"paid",amount:-s,date:In(),token:this.serializeProofs(o)}),this.storehistoryTokens(),this.invoiceHistory.push({amount:-s,bolt11:this.payInvoiceData.data.request,hash:this.payInvoiceData.data.hash,memo:this.payInvoiceData.data.memo,date:In(),status:"paid",mint:this.activeMintUrl}),this.storeInvoiceHistory(),this.payInvoiceData.invoice=!1,this.payInvoiceData.show=!1,this.payInvoiceData.blocking=!1}catch(i){throw this.payInvoiceData.blocking=!1,console.error(i),i}},checkProofsSpendable:async function(t,e=!1){if(0==t.length)return;const n={proofs:t.map((t=>({secret:t.secret})))};try{const{data:o}=await Et.Z.post(`${this.activeMintUrl}/check`,n);this.assertMintError(o);let i=t.filter(((t,e)=>!o.spendable[e]));return i.length&&(this.deleteProofs(i),e&&(this.historyTokens.push({status:"paid",amount:-this.sumProofs(i),date:In(),token:this.serializeProofs(i)}),this.storehistoryTokens())),o.spendable}catch(o){console.error(o);try{this.notifyApiError(o)}catch{}throw o}},checkFees:async function(t){const e={pr:t};try{const{data:n}=await Et.Z.post(`${this.activeMintUrl}/checkfees`,e);return this.assertMintError(n),console.log("#### checkFees",t,n.fee),n.fee}catch(n){console.error(n);try{this.notifyApiError(n)}catch{}throw n}},fetchMintKeys:async function(){try{console.log("### GET",`${this.activeMintUrl}/keys`);const{data:t}=await Et.Z.get(`${this.activeMintUrl}/keys`,{timeout:6e3}),e=t;this.assertMintError(e),this.keys=e,localStorage.setItem("cashu.keys",JSON.stringify(e));const n=await this.fetchMintKeysets();return this.mints.filter((t=>t.url==this.activeMintUrl)).length&&(this.mints.filter((t=>t.url==this.activeMintUrl))[0].keys=e,this.mints.filter((t=>t.url==this.activeMintUrl))[0].keysets=n,localStorage.setItem("cashu.mints",JSON.stringify(this.mints))),e}catch(t){console.error(t);try{this.notifyApiError(t)}catch{}throw t}},fetchMintKeysets:async function(){try{const{data:t}=await Et.Z.get(`${this.activeMintUrl}/keysets`,{timeout:6e3});return this.assertMintError(t),this.keysets=t.keysets,localStorage.setItem("cashu.keysets",JSON.stringify(t.keysets)),t.keysets}catch(t){console.error(t);try{this.notifyApiError(t)}catch{}throw t}},setInvoicePaid:async function(t){const e=this.invoiceHistory.find((e=>e.hash===t));e.status="paid",this.storeInvoiceHistory()},checkInvoice:async function(t,e=!0){console.log("### checkInvoice.hash",t);const n=this.invoiceHistory.find((e=>e.hash===t));try{null!=n.mint&&await this.activateMint(n.mint,!1);const t=await this.mint(n.amount,n.hash,e);return t}catch(o){throw e&&this.notify("Invoice still pending"),console.log("Invoice still pending",n.hash),o}},checkPendingInvoices:async function(){const t=10;let e=0;for(const o of this.invoiceHistory){if(e>=t)break;if("pending"===o.status&&o.amount>0)try{await this.checkInvoice(o.hash,!1)}catch(n){throw console.log(`${o.hash} still pending`),n}e+=1}},checkPendingTokens:async function(){const t=10;let e=0;for(const n of this.historyTokens){if(e>=t)break;"pending"===n.status&&n.amount<0&&this.checkTokenSpendable(n.token,!1),e+=1}},setTokenPaid:async function(t){const e=this.historyTokens.find((e=>e.token===t));e.status="paid",this.storehistoryTokens()},checkTokenSpendable:async function(t,e=!0){const n=this.decodeToken(t),o=this.getProofs(n);this.getMint(n).length>0&&await this.activateMint(this.getMint(n));const i=await this.checkProofsSpendable(o);let a=!1;return i.includes(!1)&&(this.setTokenPaid(t),a=!0),a?(window.navigator.vibrate&&navigator.vibrate(200),this.notifySuccess("Token paid.")):(console.log("### token not paid yet"),e&&this.notify("Token still pending")),a},findTokenForAmount:function(t){for(const e of this.activeProofs){const n=e.promises?.findIndex((e=>e.amount===t));if(n>=0)return{promise:e.promises[n],secret:e.secrets[n],r:e.rs[n]}}},clearAllWorkers:function(){this.invoiceCheckListener&&clearInterval(this.invoiceCheckListener),this.tokensCheckSpendableListener&&clearInterval(this.tokensCheckSpendableListener)},invoiceCheckWorker:async function(){let t=0;this.clearAllWorkers(),this.invoiceCheckListener=setInterval((async()=>{try{t+=1,t>40&&(console.log("### stopping invoice check worker"),this.clearAllWorkers()),console.log("### invoiceCheckWorker setInterval",t),console.log(this.invoiceData),await this.checkInvoice(this.invoiceData.hash,!1),console.log("### stopping invoice check worker"),this.clearAllWorkers(),this.invoiceData.bolt11="",this.showInvoiceDetails=!1,window.navigator.vibrate&&navigator.vibrate(200),this.notifySuccess("Payment received","top")}catch(e){console.log("invoiceCheckWorker: not paid yet")}}),3e3)},checkTokenSpendableWorker:async function(){let t=0;this.clearAllWorkers(),this.tokensCheckSpendableListener=setInterval((async()=>{try{t+=1,t>24&&(console.log("### stopping token check worker"),this.clearAllWorkers()),console.log("### checkTokenSpendableWorker setInterval",t),console.log(this.sendData);let e=await this.checkTokenSpendable(this.sendData.tokensBase64,!1);e&&(console.log("### stopping token check worker"),this.clearAllWorkers(),this.sendData.tokens="",this.showSendTokens=!1)}catch(e){console.log("checkTokenSpendableWorker: not paid yet")}}),3e3)},assertMintError:function(t,e=!0){if(null!=t.error)throw e&&this.notifyError(t.error,"Mint error"),new Error(`Mint error: ${t.error}`)},registerPWAEventHook:function(){window.addEventListener("beforeinstallprompt",(t=>{this.deferredPWAInstallPrompt=t,console.log("'beforeinstallprompt' event was fired.",this.getPWADisplayMode())}))},getPWADisplayMode:function(){const t=window.matchMedia("(display-mode: standalone)").matches;return document.referrer.startsWith("android-app://")?"twa":navigator.standalone||t?"standalone":"browser"},triggerPWAInstall:function(){this.deferredPWAInstallPrompt.prompt(),this.deferredPWAInstallPrompt.userChoice.then((t=>{"accepted"===t.outcome?(console.log("User accepted the install prompt"),this.setWelcomeDialogSeen()):console.log("User dismissed the install prompt")}))},registerLocalStorageSyncHook:function(){window.addEventListener("storage",(t=>{"cashu.proofs"==t.key&&(this.proofs=JSON.parse(t.newValue)),"cashu.activeMintUrl"==t.key&&this.activateMint(t.newValue)}))},getLocalstorageToFile:async function(){const t=`cashu_backup_${In()}.json`;for(var e={},n=0;n<localStorage.length;n++){var o=localStorage.key(n),i=localStorage.getItem(o);e[o]=i}var a=JSON.stringify(e),s=new Blob([a],{type:"text/plain"}),r=window.URL.createObjectURL(s),l=document.createElement("a");l.download=t,l.innerHTML="Download File",l.href=r,l.onclick=function(){document.body.removeChild(event.target)},l.style.display="none",document.body.appendChild(l),l.click()},storeInvoiceHistory:function(){localStorage.setItem("cashu.invoiceHistory",JSON.stringify(this.invoiceHistory))},storehistoryTokens:function(){localStorage.setItem("cashu.historyTokens",JSON.stringify(this.historyTokens))},storeProofs:function(){localStorage.setItem("cashu.proofs",JSON.stringify(this.proofs,Ht))},migrationLocalstorage:async function(){for(var t in localStorage){let e=t.match("cashu.(.+).proofs");if(null!=e){console.log("Migrating mint",e[1]);let t=e[1];const n=JSON.parse(localStorage.getItem(`cashu.${t}.proofs`));if(n){this.proofs=this.proofs.concat(n),this.storeProofs();let e=this.baseHost+`/cashu/api/v1/${t}`;console.log("Adding mint",e),await this.addMint(e),localStorage.removeItem(`cashu.${t}.proofs`)}}}},mintKey:function(t,e){return"cashu."+t+"."+e}},watch:{proofs:function(){this.keysets&&(this.activeProofs=this.proofs.filter((t=>this.keysets.includes(t.id))))}},mounted:function(){},created:async function(){let t=new URL(document.location).searchParams;if(this.proofs=JSON.parse(localStorage.getItem("cashu.proofs")||"[]"),localStorage.getItem("cashu.mints")&&(this.mints=JSON.parse(localStorage.getItem("cashu.mints"))),t.get("mint")){let e=t.get("mint");await this.setTab("settings"),this.addMintDialog.mintToAdd=e,this.addMintDialog.show=!0}if(t.get("mint_id")){this.mintId=t.get("mint_id");let e=location.protocol+"//"+location.host+`/cashu/api/v1/${this.mintId}`;this.walletURL=this.baseURL+"?mint_id="+this.mintId,await this.addMint(e)}if(localStorage.getItem("cashu.activeMintUrl")){this.activeMintUrl||(this.walletURL=this.baseURL);let t=localStorage.getItem("cashu.activeMintUrl");await this.activateMint(t)}else this.setTab("settings");this.mintId.length||(this.mintId="dummy"),console.log("Mint URL "+this.activeMintUrl),console.log("Wallet URL "+this.walletURL);const e=this.activeMintUrl;if(t.get("mint_name")&&(this.mintName=t.get("mint_name")),this.invoiceHistory=JSON.parse(localStorage.getItem("cashu.invoiceHistory")||"[]"),this.historyTokens=JSON.parse(localStorage.getItem("cashu.historyTokens")||"[]"),await this.migrationLocalstorage(),t.get("token")){let e=t.get("token"),i=!1;for(var n=0;n<this.historyTokens.length;n++){var o=this.historyTokens[n].token;o==e&&this.historyTokens[n].amount>0&&(i=!0)}i||(this.receiveData.tokensBase64=t.get("token"),this.showReceiveTokens=!0)}t.get("lightning")&&(this.showParseDialog(),this.payInvoiceData.data.request=t.get("lightning")),window.history.pushState({},document.title,window.location.href),this.checkProofsSpendable(this.activeProofs,!0).catch((t=>{})),this.checkPendingInvoices().catch((t=>{})),this.checkPendingTokens().catch((t=>{})),e.length>0&&await this.activateMint(e),this.registerLocalStorageSyncHook(),this.registerPWAEventHook(),this.showWelcomeDialog()}};var Un=n(7817),Wn=n(900),Mn=n(9800),Pn=n(4106),An=n(261),Cn=n(8326),En=n(1487),Bn=n(705),Vn=n(1663),Rn=n(1357),Zn=n(1973),Hn=n(3175);const zn=(0,re.Z)(Tn,[["render",Pt]]),On=zn;de()(Tn,"components",{QCard:le.Z,QCardSection:ce.Z,QBtn:Me.Z,QTabs:Un.Z,QTab:Wn.Z,QTabPanels:Mn.Z,QTabPanel:Pn.Z,QTable:Le.Z,QTr:Qe.Z,QTd:$e.Z,QTooltip:Ne.Z,QDialog:Ae.Z,QSeparator:Ue.Z,QSpinnerTail:An.Z,QForm:Cn.Z,QImg:En.Z,QInput:We.Z,QResponsive:Bn.Z,QToolbar:Vn.Z,QAvatar:Rn.Z,QToolbarTitle:Zn.Z,QToggle:Hn.Z}),de()(Tn,"directives",{ClosePopup:Ce.Z})}}]);